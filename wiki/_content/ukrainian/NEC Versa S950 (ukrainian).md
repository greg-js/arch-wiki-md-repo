## Contents

*   [1 Загальна інформація](#.D0.97.D0.B0.D0.B3.D0.B0.D0.BB.D1.8C.D0.BD.D0.B0_.D1.96.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D1.96.D1.8F)
*   [2 Компоненти](#.D0.9A.D0.BE.D0.BC.D0.BF.D0.BE.D0.BD.D0.B5.D0.BD.D1.82.D0.B8)
*   [3 Налаштування](#.D0.9D.D0.B0.D0.BB.D0.B0.D1.88.D1.82.D1.83.D0.B2.D0.B0.D0.BD.D0.BD.D1.8F)
    *   [3.1 Процесор](#.D0.9F.D1.80.D0.BE.D1.86.D0.B5.D1.81.D0.BE.D1.80)
    *   [3.2 Текстова консоль](#.D0.A2.D0.B5.D0.BA.D1.81.D1.82.D0.BE.D0.B2.D0.B0_.D0.BA.D0.BE.D0.BD.D1.81.D0.BE.D0.BB.D1.8C)
    *   [3.3 Xorg/video](#Xorg.2Fvideo)
    *   [3.4 Xorg/input](#Xorg.2Finput)
    *   [3.5 Hitachi HDD](#Hitachi_HDD)
    *   [3.6 Звук та Ethernet](#.D0.97.D0.B2.D1.83.D0.BA_.D1.82.D0.B0_Ethernet)
    *   [3.7 Wi-Fi](#Wi-Fi)
    *   [3.8 Bluetooth](#Bluetooth)
    *   [3.9 IrDA](#IrDA)
    *   [3.10 FireWire](#FireWire)
    *   [3.11 CardBus (PCMCIA)](#CardBus_.28PCMCIA.29)
    *   [3.12 Карт-рідер](#.D0.9A.D0.B0.D1.80.D1.82-.D1.80.D1.96.D0.B4.D0.B5.D1.80)
    *   [3.13 Фрейм-буфер](#.D0.A4.D1.80.D0.B5.D0.B9.D0.BC-.D0.B1.D1.83.D1.84.D0.B5.D1.80)
    *   [3.14 Модем](#.D0.9C.D0.BE.D0.B4.D0.B5.D0.BC)
*   [4 Зовнішній монітор](#.D0.97.D0.BE.D0.B2.D0.BD.D1.96.D1.88.D0.BD.D1.96.D0.B9_.D0.BC.D0.BE.D0.BD.D1.96.D1.82.D0.BE.D1.80)
*   [5 Гібернація](#.D0.93.D1.96.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D1.96.D1.8F)
*   [6 Як розібрати](#.D0.AF.D0.BA_.D1.80.D0.BE.D0.B7.D1.96.D0.B1.D1.80.D0.B0.D1.82.D0.B8)
*   [7 Зауваження](#.D0.97.D0.B0.D1.83.D0.B2.D0.B0.D0.B6.D0.B5.D0.BD.D0.BD.D1.8F)

## Загальна інформація

NEC Versa S950 — відносно невеликий ноутбук з процесором Pentium M та матовим 14-дюймовим екраном. Він важить близько 2.2 кг і може працювати трошки більше трьох годин від штатної батареї ємністю 4800 mAh.

Ноутбук повністю сумісний з Linux, для всіх бортових пристроїв доступні опенсоурсні дрвайвера. Базова інсталяція Arch Linux проходить без жодних проблем, а наведені на цій сторінці інструкції мають допомогти остаточно налаштувати окремі компоненти. Не обов'язково виконувати їх усі, обирайте те що вам потрібно.

Вважається що читач має деякий досвід роботи з Linux і здатен поставити та налаштувати Arch самостійно.

## Компоненти

*   Процесор: Pentium M 1.73GHz
*   Екран: 14", матовий, 1280x768
*   Пам'ять: 1G
*   Чіпсет: i915GM
*   BIOS: Phoenix NoteBIOS ver.4 rev.6.1
*   Жорсткий диск: 60G Hitachi Travelstar 5K100
*   Оптичний пристрій: Philips SDVD8441
*   Звукова: SigmaTel STAC9200
*   Ethernet: Broadcom BCM5788
*   Wi-Fi: Intel PRO/Wireless 2200BG
*   Bluetooth: Broadcom 2101
*   IrDA: якийсь NSC
*   Модем: Agere Athens
*   Карт-рідер: TI FlashMedia SD
*   FireWire: TI OHCI compilant
*   Тачпад: AVC Finger sensing pad

Існує декілька модифікацій, з різним об'ємом пам'яті та hdd.

## Налаштування

### Процесор

Для керування частотою потрібен модуль **acpi-cpufreq** та один з governor'ів (cpufreq_ondemand, скоріше за все), який треба активувати утілитою cpufreq-set.

Стандартний для Arch шлях: інсталюйте cpufrequtils з [extra], перегляньте /etc/conf.d/cpufreq:

governor="ondemand" #min_freq закоментовано #max_freq закоментовано

та додайте cpufreq до DAEMONS в /etc/rc.conf (не завадить і запустити його одразу).

### Текстова консоль

Нажаль, жодного цікавого текстового режиму в BIOS. Залишайте стандартний 80x25, або вмикайте [фрейм-буферну консоль](/index.php/NEC_Versa_S950_(%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D1%81%D1%8C%D0%BA%D0%B0)#.D0.A4.D1.80.D0.B5.D0.B9.D0.BC-.D0.B1.D1.83.D1.84.D0.B5.D1.80 "NEC Versa S950 (Українська)").

### Xorg/video

Використовуйте драйвер intel. Відповідна секція з мого xorg.conf:

Section "Device" Identifier "i915G" Driver "intel" Option "DRI" "true" EndSection

```
	Section "Screen"
		Identifier		"Screen0"
		Device			"i915G"
		Monitor			"Versa display"
		DefaultColorDepth	24
		SubSection "Display"
			Depth 		24
			Modes		"1280x768"

```

Virtual 1280 1536

```
		EndSubSection
	EndSection

```

DRI забезпечується модулем i915, який буде піднято автоматично (в rc.conf можна не писати).

Режим 1280x768 має працювати без 915resolution, але там є якісь підводні камені. Уважно перевірте в якому режимі працюють X'и; при необхідності поставте 915resoulution з [community] та додайте

```
	915resolution 5с 1280 768 32

```

до rc.local (або див. /etc/conf.d/915resolution та /etc/rc.d/915resolution).

Наведеного значення параметру Virtual достатьно для конфігурації з двома екранами 1280x768 (див. нижче про [зовнішній монітор](/index.php/NEC_Versa_S950_(%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D1%81%D1%8C%D0%BA%D0%B0)#.D0.97.D0.BE.D0.B2.D0.BD.D1.96.D1.88.D0.BD.D1.96.D0.B9_.D0.BC.D0.BE.D0.BD.D1.96.D1.82.D0.BE.D1.80 "NEC Versa S950 (Українська)")). Увага: якщо хоча б одне з чисел в Virtual більше за 2048, DRI мовчки вимкнеться.

Програмне керування підсвіткою (xbacklight), схоже, відсутнє.

### Xorg/input

**Клавіатура**: клавіша Fn обробляється десь в BIOS'і, доступа до неї немає. Дві додаткові кнопки біля вмикача генерують коди 178 та 236, на них зручно ставити suspend-to-ram та suspend-to-disk.

**Тачпад**: тупий вироб фірми AVC, сидить на PS/2 — просто використовуйте /dev/input/mice і не переймайтесь налаштуваннями, яких там немає (зокрема, це не Synaptics і навіть не ALPS). Скоріше за все доводеться увімкнути Emulate3Buttons, бо третьої кнопки на ньому немає. В той же час кнопки 4 та 5 там є — це правий верхній та правий нижній кути тачпаду. Відповідна секція з мого xorg.conf:

```
	Section "InputDevice"
		Identifier		"Main mouse"
		Driver 			"mouse"
		Option "Protocol"	"auto"
		Option "Device"		"/dev/input/mice"
		Option "Emulate3Buttons" "true"
		Option "ZAxisMapping"	"4 5"
	EndSection

```

### Hitachi HDD

Див. [laptop harddrive Load_Cycle_Count issue](http://ubuntuforums.org/showthread.php?p=5031046) щодо суті проблеми. Якщо не бажаєте щоб hdd паркувався посеред роботи, додайте

```
	hdparm -q -B 250 /dev/sda

```

до /etc/rc.local.

Увага: паркування — не зважди зло. Не запускайте hdparm -B якщо не розумієте що воно робить і навіщо вам це!

### Звук та Ethernet

Інсталятор вірно визначає модулі (**snd_hda_intel** та **tg3** відповідно), додатково нічого налаштовувати не треба.

### Wi-Fi

Інсталятор правильно визначає модуль **ipw2200**, але для того щоб він працював необхідно доставити прошивку — ipw2200-fw з [core]. Додайте

```
	options ipw2200 led=1

```

до modprobe.conf щоб працював LED на передній панелі. Комбінацією Fn+F2 можна вмикати/вимикати карту.

### Bluetooth

Драйвер (**hci_usb**) піднімається автоматично. Комбінація Fn+F4 від'єднує пристрій від шини, це можна спостерігати в kernel.log.

Увага: щоб "hcitool dev" показувала пристрій, необхідно щоб працювала вся компаній bluetooth-демонів. Інсталюйте bluez-utils та перегляньте /etc/rc.d/bluetooth.

### IrDA

Підніміть модуль **nsc-ircc** та додайте його до MODULES в /etc/rc.conf. Має працювати, ала я не перевіряв.

### FireWire

Налаштування не потрібно, модуль **ohci1394** піднімається автоматично.

### CardBus (PCMCIA)

Налаштування не потрібно.

### Карт-рідер

Додатковго налаштування не потрібно, модуль **tifm_sd** піднімається автоматично. Карта буде доступна як /dev/mmcblk0, з партиціями mmcblk0p1, mmcblk0p2 і т.д.

### Фрейм-буфер

Щоб отримати 1280x768, доведеться використовувати **uvesafb**. Штуковина досить своєнравна, якщо мій рецепт не спрацює — читайте повноцінну документацію та розбирайтесь. Цей варіант лише один з можливих, є інші способи запуска.

Для роботи uvesafb, окрім самого модуля (який є в стандартному ядрі Arch), потрібен ще демон v86d. А щоб отримати саме 1280x768, 915resolution має підправити режими до того як uvesafb їх прочитає.

Отже, відправимо v86d та 915resolution до initrd. Обидва пакети є в репозітаріях Arch, але використати готові навряд чи вдастся. Перевірте чи v86d з [extra] запускається, спробуйте також натравити ldd на нього — якщо бачите сегфолти (Segmentation fault), доводеться перезібрати його з --with-x86emu. Якщо сегфолтів не було — можливо, вам пощастило. Далі пересберіть 915resoulution з klibc замість glibc (якої в initrd не буде), для цього достатньо виставити make'у CC = klcc.

Крім власне бінарників, для mkinitcpio потрібні ще hook-файли: /lib/initcpio/{install,hooks}/{915resolution,v86d}. Простіше за все взяти їх зі готових пакетів. Підправте режим в hooks/915resolution:

```
	msg -n ":: Patching the VBIOS..."
	/usr/sbin/915resolution 5c 1280 800

```

та в /etc/modprobe.d/modprobe.conf або /etc/modprobe.d/uvesafb (увага! параметр називається mode, а не mode_option!):

```
	options uvesafb mode=1280x768 scroll=ywrap

```

потім додайте обох до HOOKS в /etc/mkinitcpio.conf:

```
	HOOKS = (base udev 915resolution v86d ... )

```

і перезберіть initrd:

```
	mkinitcpio -p linux

```

Якщо все гаразд, перезапустіть систему. Можна спершу спробувати modprobe vesafb — екран повинен перемкнутися в графічний режим.

Більш детальну інформацію можна отримати на сторінці [uvesafb](/index.php/Uvesafb "Uvesafb") в Arch wiki або на [офіційному сайті uvesafb](http://dev.gentoo.org/~spock/projects/uvesafb).

**Увага**: uvesafb та suspend-to-RAM разом працювати не будуть. Обирайте щось одне.

### Модем

Модемів в цьому ноутбуці немає. Ok, ці штуки в наші часи іноді називають модемами, але то лише назва. Agere Athens (або Athena за деякими NEC'овськими спеками) являє собою щось типу AMR-карти, насадку на звукову карту з незвичайним (телефонним) конектором. Контролює її, як частину звукової, snd_hda_intel.

Зробити з цього модем можна за допомогую програми slmodem. Зберіть її з SUPPORT_ALSA=1, після чого запустіть

```
	slmodemd -a modem:0

```

Поспілкуватися з таким модемом можна через віртульний com-порт, /dev/ttySL0 звичайно.

Див. [Smartlink_Modem_drivers](/index.php/Smartlink_Modem_drivers "Smartlink Modem drivers") та [архів slmodem'ів](http://linmodems.technion.ac.il/packages/smartlink)

## Зовнішній монітор

Керування з клавіатури, здається, немає, але є вельми потужне програмне — через утіліту **xrandr**. Типові команди:

*   увімкнути сигнал: xrandr --output VGA --auto
*   вимкнути сигнал: xrandr --output VGA --off
*   здублювати основний: xrandr --output VGA --same-as LVDS
*   два незалежних екрана: xrandr --output VGA --below LVDS

Щоб двоекранна конфігурація працювала, область Virtual (див. xorg.conf) має вміщати обидва екрани одночасно. Тобто, щоб мати два екрани по 1280x768 один-під-другим, Virtual має будти не меньше ніж 1280 1536.

## Гібернація

**S4** (suspend-to-disk), зається, працює добре. **S3** (suspend-to-RAM) теж працює, але *тільки* якщо немає uvesafb. Якщо він є, X-сервер помре одразу після пробудження, і вже не запуститься аж до перезапуска системи. Можливо, ситуація зміниться з майбутьніми версіями xf86-video-intel та uvesafb, але зараз використовувати їх разом не можна.

Після виходу з S3 треба зробити POST відеокарті, інакше на консолях не буде зображення. Крім того, жорсткий диск "забуває" про hdparm -b під час сну, отже, бажано зробити так щоб ця команда виконувалась кожен раз коли ноут прокидається.

Активувати режими сну можна кількома способами:

**Безпосередньо через ядро**: щоб активувати режим S4, виконайте

```
	echo 4 > /proc/acpi/sleep

```

Вмикати S3 таким чином не варто.

**uswsusp**: команди **s2disk** для S4 та **s2ram** для S3, останній потрібна опція --vbe_post (або з відповідним рядок в whitelist.c, в останньому полі має бути VBE_POST).

**pm-utils**: команди **pm-suspend** для S3 та **pm-hibernate** для S4.

В обох режимах пробудити ноутбук можна кнопкою Power. Для S4 не забувайте про resume= в параметрах ядра.

За додатковою інформацією див. [Suspend_to_Disk](/index.php/Suspend_to_Disk "Suspend to Disk") та [Suspend_to_RAM](/index.php/Suspend_to_RAM "Suspend to RAM") в Arch wiki.

Увага: жорсткий диск "забуває" про hdparm -B після пробудження.

## Як розібрати

Іноді необхідно зняти окремі деталі ноутбука (хоча б для чистки). Оскільки офіційне Disassembly guide знайти, здається, неможливо, навожу деяку інформацію тут.

**Пам'ять та WiFi-карта**: під кришкою на нижній поверхні. Кришка тримається двома винтами.

**Оптичній пристрій**: там же, зліва від кришки два винта. Треба зняти той що ближче до поверхні (не глибокий), після чого штовхати металевий хвостик, який виглядає з-під краю отвору поряд з WiFi картою.

**Клавіатура**: тут треба зняти пластикову панель з індікаторами та кнопками. Для цього викручуємо винти ззаду петель екрана, знімаємо батарею та відкриваємо екран на 180°. Далі треба трошки обернути її навколо ближньої до клавіатури сторони, штовхаючи дальну сторону догори. Зліва та справа від батарейного відсіку можна підсунути маленьку викрутку.

Сама клавіатура тримається двома винтами зверху та одним знизу, біля нього стоїть відмітка (K). Незакріплену клавіатуру треба штовхати в бік екрану.

**Вентилятор**: під клавіатурою.

## Зауваження

Не натискайте занадто сильно на верхню кришку, вона доволі м'яка, можна пошкодити екран (подряпати його о край клавіатури).

Коли ноутбук працює з максимальним навантаженням, стоячи при цьому на поверхні (столі і т.і.), температура в термозоні (процессор) піднімається вище 70°C. Ситуація покращіться, якщо підняти його на пару сантиметрів над поверхнею так, щоб повітря могло вільно надходити до вхідного отвору вентилятора — температура одразу впаде до ~65°C.

Wi-Fi карта встановлена в звичайний miniPCI слот, схований під кришкою на нижньому боці ноутбука. При необхідності ії можна змінити на щось інше.