Related articles

*   [Основные рекомендации](/index.php/%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8 "Основные рекомендации")

**Состояние перевода:** На этой странице представлен перевод статьи [System maintenance](/index.php/System_maintenance "System maintenance"). Дата последней синхронизации: 25 марта 2016\. Вы можете [помочь](/index.php/ArchWiki_Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ArchWiki Translation Team (Русский)") синхронизировать перевод, если в английской версии произошли [изменения](https://wiki.archlinux.org/index.php?title=System_maintenance&diff=0&oldid=427603).

Регулярное обслуживание системы необходимо для правильной работы Arch в течение определенного периода времени. Своевременное обслуживание является привычной практикой многих пользователей.

<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none">

## Contents

<label class="toctogglelabel" for="toctogglecheckbox"></label>

*   [1 Проверка на наличие ошибок](#Проверка_на_наличие_ошибок)
    *   [1.1 Неудачный запуск служб systemd](#Неудачный_запуск_служб_systemd)
    *   [1.2 Файлы журналов](#Файлы_журналов)
*   [2 Резервное копирование](#Резервное_копирование)
    *   [2.1 Файлы настроек](#Файлы_настроек)
    *   [2.2 Список установленных приложений](#Список_установленных_приложений)
    *   [2.3 База данных Pacman](#База_данных_Pacman)
    *   [2.4 Заголовки LUKS](#Заголовки_LUKS)
*   [3 Обновление системы](#Обновление_системы)
    *   [3.1 Избегайте определенных команд pacman](#Избегайте_определенных_команд_pacman)
    *   [3.2 Частичные обновления не поддерживаются](#Частичные_обновления_не_поддерживаются)
    *   [3.3 Прочитайте перед обновлением системы](#Прочитайте_перед_обновлением_системы)
    *   [3.4 Сигналы предупреждений во время обновления](#Сигналы_предупреждений_во_время_обновления)
    *   [3.5 Как можно быстрее договаривайтесь с новыми файлами настроек](#Как_можно_быстрее_договаривайтесь_с_новыми_файлами_настроек)
    *   [3.6 Откат сломанных обновлений](#Откат_сломанных_обновлений)
*   [4 Используйте менеджер пакетов для установки программного обеспечения](#Используйте_менеджер_пакетов_для_установки_программного_обеспечения)
    *   [4.1 Выбирайте драйверы с открытым исходным кодом](#Выбирайте_драйверы_с_открытым_исходным_кодом)
    *   [4.2 Будьте осторожны с неофициальными пакетами](#Будьте_осторожны_с_неофициальными_пакетами)
    *   [4.3 Обновите список зеркал (mirrorlist)](#Обновите_список_зеркал_(mirrorlist))
*   [5 Очистите файловую систему](#Очистите_файловую_систему)
    *   [5.1 Старые файлы настроек](#Старые_файлы_настроек)
    *   [5.2 Неиспользуемые пакеты](#Неиспользуемые_пакеты)
    *   [5.3 Кэш пакетов](#Кэш_пакетов)
    *   [5.4 Сломанные симлинки](#Сломанные_симлинки)
*   [6 Советы и приёмы](#Советы_и_приёмы)
    *   [6.1 Используйте проверенные программные пакеты](#Используйте_проверенные_программные_пакеты)
    *   [6.2 Установите пакет linux-lts](#Установите_пакет_linux-lts)
*   [7 Смотрите также](#Смотрите_также)

## Проверка на наличие ошибок

### Неудачный запуск служб systemd

Проверьте, возможно какие-либо службы systemd неудачно запустились:

```
$ systemctl --failed

```

Для большей информации смотрите [Systemd (Русский)#Анализ состояния системы](/index.php/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Анализ_состояния_системы "Systemd (Русский)").

### Файлы журналов

Посмотрите на наличие ошибок файл журнала, находящийся в `/var/log`, а также высоко приоритетные ошибки в журнале systemd:

```
# journalctl -p 3 -xb

```

Смотрите [Systemd (Русский)#Журнал](/index.php/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Журнал "Systemd (Русский)") для большей информации.

Смотрите [Xorg (Русский)#Проблемы](/index.php/Xorg_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Проблемы "Xorg (Русский)") о том где и как получить информацию о журналах ошибок [Xorg](/index.php/Xorg_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Xorg (Русский)").

## Резервное копирование

Создавайте резервные копии важных данных через регулярные промежутки времени. Эти данные включают в себя конфигурационные файлы, установленные пакеты и каталоги, такие как `/etc`, `/home`, `/var` и для серверных установок, также `/srv`.

Смотрите различные приложения [синхронизации и программ резервного копирования](/index.php/Synchronization_and_backup_programs "Synchronization and backup programs") которые подойдут в вашем случае. Также смотрите [восстановление системы](/index.php/Category:System_recovery_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Category:System recovery (Русский)").

Резервное копирование можно автоматизировать с помощь [Systemd/Tаймеры](/index.php/Systemd/T%D0%B0%D0%B9%D0%BC%D0%B5%D1%80%D1%8B "Systemd/Tаймеры").

### Файлы настроек

Перед внесением изменений в файлы настроек, создайте резервную копию. Таким образом, вы можете вернуться к рабочей версии в случае возникновения проблем. Такие редакторы как [vim](/index.php/Vim_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Vim (Русский)") и [emacs](/index.php/Emacs "Emacs") могут сделать это автоматически, а также такая утилита как [etckeeper](/index.php/Etckeeper "Etckeeper") держат `/etc` в системе контроля версий (VCS).

### Список установленных приложений

Ведите список всех установленных пакетов, а если полная переустановка неизбежна, то легче будет воссоздать первоначальное окружение.

Для подробностей смотрите [Pacman/Советы и приёмы#Резервное копирование и извлечение списка установленных пакетов](/index.php/Pacman/%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D0%BF%D1%80%D0%B8%D1%91%D0%BC%D1%8B#Резервное_копирование_и_извлечение_списка_установленных_пакетов "Pacman/Советы и приёмы").

### База данных Pacman

Смотрите [Pacman/Советы и приёмы#Создание резервной копии базы данных Pacman](/index.php/Pacman/%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D0%BF%D1%80%D0%B8%D1%91%D0%BC%D1%8B#Создание_резервной_копии_базы_данных_Pacman "Pacman/Советы и приёмы").

### Заголовки LUKS

Переодически проверяйте и синхронизируйте резервные копии LUKS-шифрованные заголовки разделов, особенно если ключевые фразы были аннулированы. Смотрите [Dm-crypt/Device encryption#Backup and restore](/index.php/Dm-crypt/Device_encryption#Backup_and_restore "Dm-crypt/Device encryption").

## Обновление системы

Рекомендуется регулярно выполнять полное обновление системы, чтобы насладиться последними исправлениями и обновлениями безопасности, а также, чтобы не иметь дело со слишком большим количеством обновлений пакетов, которые сразу требуют ручного вмешательства. Для подробностей смотрите [Pacman (Русский)#Обновление пакетов](/index.php/Pacman_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Обновление_пакетов "Pacman (Русский)"). Убедитесь в том, что имеете установочный носитель Arch или доступен другой "live" Linux CD/USB, так что вы можете легко восстановить вашу систему, если появится проблема после обновления. Если вы используете Arch в рабочей среде, или не можете позволить себе время простоя по любой причине, - тестируйте изменения в файлах настроек, а также обновления программных пакетов на некритичных дубликатах первой системы. Тогда, если не будет никаких проблем, - сделаете изменения в рабочей среде.

Если в системе есть пакеты из [AUR](/index.php/AUR_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "AUR (Русский)"), внимательно обновите все из них.

### Избегайте определенных команд pacman

Избегайте [частичные обновления](#Частичные_обновления_не_поддерживаются), то есть никогда не запускайте `pacman -Sy`, вместо того чтобы использовать `pacman -Syu`.

Избегайте использования опции `--force` с Pacman, **особенно** в таких командах, как `pacman -Syu --force` с участием более чем одного пакета. Опция `--force` игнорирует конфликты файлов и может даже привести к потере файлов, когда файлы будут перемещены между различными пакетами! В правильно поддерживаемой системе, она должна использоваться только тогда, когда явно рекомендуется разработчиками Arch (смотрите [#Прочитайте перед обновлением системы](#Прочитайте_перед_обновлением_системы)).

Избегайте использования опции `-d` с Pacman. `pacman -Rdd пакет` пропустит проверку зависимостей при удалении пакета. В результате пакет, создающий критическую зависимость, может быть удален, что приведет к нарушению системы.

### Частичные обновления не поддерживаются

Arch Linux является [роллинг-релиз](https://en.wikipedia.org/wiki/ru:rolling_release поступит в репозиторий, разработчики и доверенные пользователи пересоберут все пакеты в репозиториях, которые должны быть пересобраны с библиотеками. Например, если два пакета зависят от той же библиотеки, обновление только одного пакета может также обновить библиотеку (в качестве зависимости), которая может сломать другой пакет, который зависит от старой версии библиотеки.

Именно поэтому частичные обновления являются **не поддерживаемыми**. Не используйте `pacman -Sy пакет` или любой эквивалент, такой как `pacman -Sy` а затем `pacman -S пакет`, **всегда** обновляйтесь (с помощью `pacman -Syu`) перед установкой пакета. По той же причине будьте очень осторожны при использовании `IgnorePkg` и `IgnoreGroup`. Если в системе есть локально установленные пакеты (например, пакеты из [AUR](/index.php/AUR_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "AUR (Русский)")), пользователи должны будут пересобрать их, когда их зависимост получит [игнор](https://en.wikipedia.org/wiki/soname "wikipedia:soname").

Если было частичное обновление, и бинарные файлы сломаны, потому что они не могут найти зависимые библиотеки, **не "исправляйте" проблему при помощи символьной ссылки**. Библиотеки получают [игнор](https://en.wikipedia.org/wiki/soname "wikipedia:soname"), когда они **не имеет обратной совместимости**. Выполнение команды `pacman -Syu` с правильно синхронизированным зеркалом решит проблему, пока сам "pacman" работоспособен.

Баш скрипт *checkupdates*, который входит в пакет pacman, обеспечивает безопасный способ проверки наличия обновлений для установленных пакетов, одновременно без запуска обновления системы. Смотрите также [BBS ## 1563725](https://bbs.archlinux.org/viewtopic.php?pid=1563725#p1563725).

### Прочитайте перед обновлением системы

Перед обновлением Arch, всегда читайте последние [Новости Arch](http://archlinux.org.ru/news/), чтобы узнать, есть ли какие-либо основные программные изменения или настройки с последними пакетами. Перед обновлением основного программного обеспечения (например, [kernel](/index.php/%D0%AF%D0%B4%D1%80%D0%B0 "Ядра"), [xorg](/index.php/Xorg_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Xorg (Русский)"), [systemd](/index.php/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Systemd (Русский)"), или [glibc](https://www.archlinux.org/packages/?name=glibc)) на новую версию, посмотрите соответствующий [форум](http://archlinux.org.ru/forum/), чтобы увидеть, были ли какие-либо сообщения о проблемах.

### Сигналы предупреждений во время обновления

При обновлении системы, не забудьте обратить внимание на оповещающие уведомления, предусмотренных [Pacman](/index.php/Pacman_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Pacman (Русский)"). Если какие-либо дополнительные действия потребуются от пользователя, сделайте их сразуже. Если предупреждения pacman сбивают с толку, то для получения более подробных инструкций поищите на форумах и просмотрите недавние сообщения новостей.

### Как можно быстрее договаривайтесь с новыми файлами настроек

Когда вызывается pacman, могут быть созданы файлы `.pacnew` и `.pacsave`. Pacman уведомит вас, когда это произойдет, и пользователи должны разобраться с этими файлами в кратчайшие сроки. Пользователи могут обратиться к вики-страницы [Pacman/Pacnew and Pacsave (Русский)](/index.php/Pacman/Pacnew_and_Pacsave_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Pacman/Pacnew and Pacsave (Русский)") для подробных инструкций.

Кроме того, подумайте о других файлах настроек которые вы можете скопировать или создать. Если пакет содержал пример настроек, который был скопирован в ваш домашний каталог, проверьте, был ли создан новый.

### Откат сломанных обновлений

Если пакет обновления предполагаемый/известный создаёт проблемы, pacman отобразит соответствующее сообщение, когда пакет обновляется. Если возникли проблемы после обновления, перепроверьте вывод pacman, просмотрев `/var/log/pacman.log`.

Только после того, когда нет никакой информации доступной от Pacman, нет новости на [http://archlinux.org.ru](http://archlinux.org.ru), и нет сообщений на форуме по поводу обновления, рассмотрите возможность обращения за помощью на [форум](http://archlinux.org.ru/forum/) и в [IRC](/index.php/IRC "IRC"), либо ["откатите" пакет](/index.php/%D0%9E%D1%82%D0%BA%D0%B0%D1%82_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2 "Откат пакетов").

## Используйте менеджер пакетов для установки программного обеспечения

[Pacman](/index.php/Pacman_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Pacman (Русский)") делает работу намного лучше, чем ваше ручное содержание файлов. Если вы устанавливаете пакеты вручную, вы *в скором времени*, рано или поздно, забудете что вы делали, устанавливали конфликтующее программное обеспечение, устанавливали в неправильное место и т.д. Вместо этого, узнайте, как [создать пакет](/index.php/%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2 "Создание пакетов").

Чтобы очистить неправильно установленные файлы, смотрите [Pacman/Советы и приёмы#Найти файлы не принадлежащие любому пакету](/index.php/Pacman/%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D0%BF%D1%80%D0%B8%D1%91%D0%BC%D1%8B#Найти_файлы_не_принадлежащие_любому_пакету "Pacman/Советы и приёмы").

### Выбирайте драйверы с открытым исходным кодом

Всегда старайтесь использовать драйверы с открытым исходным кодом, прежде чем прибегнуть к проприетарным драйверам. Большую часть времени, драйверы с открытым исходным кодом являются более стабильными и надежными, чем проприетарные драйверы. Ошибки драйверов с открытым исходным кодом исправляются более легко и быстро. В то время как закрытые драйверы могут предложить больше функций и возможностей, это может происходить за счет стабильности. Чтобы избежать этой дилеммы, попробуйте выбрать аппаратные компоненты (железо), известные и имеющие развитую поддержку открытых драйверов с полными функциями. Информацию об аппаратном обеспечении с открытым исходным кодом драйверов Linux можно найти на [linux-drivers.org](http://www.linux-drivers.org/).

### Будьте осторожны с неофициальными пакетами

Используйте меры предосторожности при использовании пакетов из [AUR](/index.php/AUR_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "AUR (Русский)") или [неофициальных пользовательских репозиториев](/index.php/Unofficial_user_repository "Unofficial user repository"). Большинство из них содержатся обычными пользователями, и, следовательно, не могут иметь те же стандарты, что и в официальных репозиториях. Будьте осторожны с [вспомогательными утилитами для работы с AUR](/index.php/AUR_helpers_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "AUR helpers (Русский)"), которые весьма упрощают установку пакетов AUR. **Всегда** проверяйте PKGBUILD'ы на вменяемость, признаки ошибок или вредоносного кода, прежде чем собрать и/или установить пакет.

Для упрощения технического обслуживания, ограничьте количество используемых неофициальных пакетов. Делайте периодические проверки на актуальность их использования, и удалите (или замените их на официальный аналог) либо на другие. Смотрите полезные команды [Pacman/Советы и приёмы#Обслуживание](/index.php/Pacman/%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D0%BF%D1%80%D0%B8%D1%91%D0%BC%D1%8B#Обслуживание "Pacman/Советы и приёмы").

### Обновите список зеркал (mirrorlist)

Обновите список зеркал pacman, так как качество зеркал может меняться со временем, и некоторые из них могут перейти в офлайн или их скорость загрузки может ухудшиться. Смотрите [Зеркала](/index.php/%D0%97%D0%B5%D1%80%D0%BA%D0%B0%D0%BB%D0%B0 "Зеркала").

## Очистите файловую систему

При поиске файлов для удаления, важно найти файлы, которые занимают большую часть дискового пространства. Программы, которые вам помогут можно найти в:

*   [Список приложений#Информация об использовании дискового пространства](/index.php/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9#Информация_об_использовании_дискового_пространства "Список приложений").
*   [Список приложений#Очистка диска](/index.php/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9#Очистка_диска "Список приложений").

### Старые файлы настроек

Старые файлы настроек могут конфликтовать с новыми версиями программного обеспечения, или портиться со временем. Периодически удаляйте ненужные файлы настроек, особенно в вашей домашней папке и `~/.config`. По тем же причинам, будьте осторожны при совместном использовании домашних папок между установками.

Посмотрите на следующие папки:

*   `~/.config/` -- здесь приложения хранят свои настройки
*   `~/.cache/` -- кэш некоторых программ может увеличиваться в размерах
*   `~/.local/share/` -- а тут могут лежать старые файлы

Для большей информации смотрите [XDG Base Directory support](/index.php/XDG_Base_Directory_support "XDG Base Directory support").

Чтобы сохранить домашний каталог чистым от временных файлов, созданных в неправильном месте, будет хорошо иметь список нежелательных файлов и удалять их регулярно, например, с помощью [rmshit.py](https://github.com/lahwaacz/Scripts/blob/master/rmshit.py).

[rmlint](https://www.archlinux.org/packages/?name=rmlint) может быть использован для поиска и при необходимости удалении дубликатов файлов, пустых файлов, рекурсивных пустых каталогов и сломанных символических ссылок.

### Неиспользуемые пакеты

Удалите неиспользуемые пакеты из системы, тем самым освободив место на диске и упростив обслуживание.

Для подробностей смотрите [Pacman/Советы и приёмы#Удаление неиспользуемых пакетов](/index.php/Pacman/%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D0%BF%D1%80%D0%B8%D1%91%D0%BC%D1%8B#Удаление_неиспользуемых_пакетов "Pacman/Советы и приёмы").

### Кэш пакетов

Удалите ненужные файлы `.pkg` из `/var/cache/pacman/pkg/` чтобы освободить дисковое пространство. .

Для большей информации смотрите [Pacman (Русский)#Очистка кэша пакетов](/index.php/Pacman_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Очистка_кэша_пакетов "Pacman (Русский)").

### Сломанные симлинки

Старые, сломанные символьные ссылки могут находится в вашей системе; вы должны удалить их. Найти примеры того как их найти указаны [тут (Англ.)](https://unix.stackexchange.com/questions/34248/how-can-i-find-broken-symlinks) и [там (Англ.)](http://www.commandlinefu.com/commands/view/8260/find-broken-symlinks).

Для быстрого просмотра списка всех сломанных символьных ссылок в вашей системе, воспользуйтесь:

```
 # find . -type l -! -exec test -e {} \; -print

```

Затем проверьте и удалите ненужные записи из этого списка.

## Советы и приёмы

Следующие советы, как правило не требуется, но некоторые пользователи могут счесть их полезными.

### Используйте проверенные программные пакеты

Роллинг-релиз Arch даёт преимущество пользователям, которые хотят попробовать новейшие функции и получить последние обновления как можно скорее, но это может сделать обслуживание системы более трудным. Для упрощения технического обслуживания и повышения стабильности, старайтесь избегать ультрасовременное программное обеспечение и устанавливайте только зрелое и проверенные программное обеспечение. Такие пакеты имеют меньше шансов получить сложные обновления, такие как основные изменения настроек или удаление особенностей. Предпочитайте программное обеспечение, которое имеет сильное и активное сообщество разработчиков, а также большое количество компетентных пользователей, для того чтобы упростить поддержку в случае возникновения проблем.

Избегайте использования тестового (testing) репозитория, даже отдельных пакетов из testing. Эти пакеты являются экспериментальными и не подходят для стабильной системы. Кроме того, избегайте разрабатываемых пакетов, которые собираются непосредственно из апстрима. Они обычно находятся в [AUR](/index.php/AUR_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "AUR (Русский)"), и содержат в названии: "dev", "devel", "svn", "cvs", "git", и т.д.

### Установите пакет linux-lts

Пакет [linux-lts](https://www.archlinux.org/packages/?name=linux-lts) представляет собой альтернативный пакет ядра Arch, и доступен в [core](/index.php/%D0%9E%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D1%80%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B8#core "Официальные репозитории") репозитории. Эта конкретная версия ядра имеет долгосрочную поддержку (LTS) от апстрима, включая исправления безопасности, и некоторые Бэкпорты. Это будет полезным, если вы предпочитаете стабильность и менее частые обновления ядра, или если вы хотите иметь запасное ядро, в случае если новая версия ядра вызывает проблемы.

Для того, чтобы сделать его доступным в качестве варианта загрузки, вам нужно будет обновить файл настроек [загрузчика](/index.php/%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D1%87%D0%B8%D0%BA%D0%B8 "Загрузчики"), для использования ядра LTS и ram disk: `vmlinuz-linux-lts` и `initramfs-linux-lts.img`.

## Смотрите также

*   [Bash-скрипт для новостей Arch (Англ.)](https://bbs.archlinux.org/viewtopic.php?id=146850)