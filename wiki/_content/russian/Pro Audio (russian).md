Ссылки по теме

*   [Sound system](/index.php/Sound_system "Sound system")
*   [envy24control](/index.php/Envy24control "Envy24control")

Современные версии Linux имеют очень хорошую поддержку (полу-)профессионального аудио. Задержки в 5 мс и даже ниже, например, в 1 мс могут быть достигнуты при хорошей аппаратной поддержке и должной настройке.

## Contents

*   [1 Начало работы](#.D0.9D.D0.B0.D1.87.D0.B0.D0.BB.D0.BE_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.8B)
    *   [1.1 Настройка системы](#.D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B)
        *   [1.1.1 Проверка настроек](#.D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B5.D0.BA)
    *   [1.2 JACK](#JACK)
        *   [1.2.1 FireWire](#FireWire)
        *   [1.2.2 Jack Flash](#Jack_Flash)
        *   [1.2.3 Скрипт быстрой проверки Jack (Quickscan)](#.D0.A1.D0.BA.D1.80.D0.B8.D0.BF.D1.82_.D0.B1.D1.8B.D1.81.D1.82.D1.80.D0.BE.D0.B9_.D0.BF.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B8_Jack_.28Quickscan.29)
    *   [1.3 Распространённые примеры](#.D0.A0.D0.B0.D1.81.D0.BF.D1.80.D0.BE.D1.81.D1.82.D1.80.D0.B0.D0.BD.D1.91.D0.BD.D0.BD.D1.8B.D0.B5_.D0.BF.D1.80.D0.B8.D0.BC.D0.B5.D1.80.D1.8B)
*   [2 Режим реального времени ядра](#.D0.A0.D0.B5.D0.B6.D0.B8.D0.BC_.D1.80.D0.B5.D0.B0.D0.BB.D1.8C.D0.BD.D0.BE.D0.B3.D0.BE_.D0.B2.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.B8_.D1.8F.D0.B4.D1.80.D0.B0)
    *   [2.1 ABS](#ABS)
    *   [2.2 AUR](#AUR)
*   [3 MIDI](#MIDI)
*   [4 Переменные окружения](#.D0.9F.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.B5_.D0.BE.D0.BA.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F)
*   [5 Советы и рекомендации](#.D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8)
*   [6 Оборудование](#.D0.9E.D0.B1.D0.BE.D1.80.D1.83.D0.B4.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5)
    *   [6.1 M-Audio Delta 1010](#M-Audio_Delta_1010)
    *   [6.2 M-Audio Fast Track Pro](#M-Audio_Fast_Track_Pro)
    *   [6.3 PreSonus Firepod](#PreSonus_Firepod)
    *   [6.4 PreSonus AudioBox USB](#PreSonus_AudioBox_USB)
*   [7 Несвободные приложения](#.D0.9D.D0.B5.D1.81.D0.B2.D0.BE.D0.B1.D0.BE.D0.B4.D0.BD.D1.8B.D0.B5_.D0.BF.D1.80.D0.B8.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F)
    *   [7.1 Steinberg'овые SDK](#Steinberg.27.D0.BE.D0.B2.D1.8B.D0.B5_SDK)
*   [8 Проект Arch Linux Pro Audio](#.D0.9F.D1.80.D0.BE.D0.B5.D0.BA.D1.82_Arch_Linux_Pro_Audio)
*   [9 Linux и Arch Linux Pro Audio в новостях](#Linux_.D0.B8_Arch_Linux_Pro_Audio_.D0.B2_.D0.BD.D0.BE.D0.B2.D0.BE.D1.81.D1.82.D1.8F.D1.85)

## Начало работы

Начните с установки [JACK](/index.php/JACK "JACK").

Следующие пакеты являются хорошим началом для построения полнофункциональной профессиональной аудиосистемы:

*   [qjackctl](https://www.archlinux.org/packages/?name=qjackctl)
*   [patchage](https://www.archlinux.org/packages/?name=patchage)
*   [ardour](https://www.archlinux.org/packages/?name=ardour)
*   [qtractor](https://www.archlinux.org/packages/?name=qtractor)
*   [hydrogen](https://www.archlinux.org/packages/?name=hydrogen)
*   [musescore](https://www.archlinux.org/packages/?name=musescore)
*   [rosegarden](https://www.archlinux.org/packages/?name=rosegarden)
*   [qsynth](https://www.archlinux.org/packages/?name=qsynth)
*   [jsampler](https://www.archlinux.org/packages/?name=jsampler)
*   [lmms](https://www.archlinux.org/packages/?name=lmms)
*   [calf](https://www.archlinux.org/packages/?name=calf)
*   [dssi](https://www.archlinux.org/packages/?name=dssi)
*   [guitarix2](https://www.archlinux.org/packages/?name=guitarix2)

Остальные пакеты, которые вам могут понадобиться доступны в [AUR](/index.php/AUR "AUR"):

*   [traverso](https://aur.archlinux.org/packages/traverso/)
*   [qsampler](https://www.archlinux.org/packages/?name=qsampler) (смотрите также [LinuxSampler](/index.php/LinuxSampler "LinuxSampler"))
*   [mhwaveedit](https://aur.archlinux.org/packages/mhwaveedit/)
*   [carla](https://www.archlinux.org/packages/?name=carla)
*   [rakarrack-git](https://aur.archlinux.org/packages/rakarrack-git/)
*   [XCFA](https://aur.archlinux.org/packages/XCFA/)
*   [yoshimi](https://www.archlinux.org/packages/?name=yoshimi)
*   [fsthost](https://aur.archlinux.org/packages/fsthost/)
*   [wineasio](https://aur.archlinux.org/packages/wineasio/)
*   [vst-bridge](https://github.com/abique/vst-bridge)

См. также [Список приложений аудио](/index.php/List_of_applications_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#.D0.90.D1.83.D0.B4.D0.B8.D0.BE "List of applications (Русский)") и [Список редакторов аудио](/index.php/List_of_applications_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#.D0.A0.D0.B5.D0.B4.D0.B0.D0.BA.D1.82.D0.BE.D1.80.D1.8B_.D0.B0.D1.83.D0.B4.D0.B8.D0.BE "List of applications (Русский)").

### Настройка системы

Рассмотрим наиболее частые конфигурации:

*   Добавляем свою учётную запись в группу [аудио](/index.php/%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B8_%D0%B8_%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D1%8B#.D0.A3.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B3.D1.80.D1.83.D0.BF.D0.BF.D0.B0.D0.BC.D0.B8 "Пользователи и группы")
*   Добавим строку `threadirqs` в [параметры ядра](/index.php/%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B_%D1%8F%D0%B4%D1%80%D0%B0 "Параметры ядра")

**Важно:** Включение `threadirqs` в сочетании с некоторыми USB устройствами может явиться причиной зависания системы, по крайней мере в некоторых версиях ядра, начиная с 3.13 и, в том числе, 3.14-RC2 [[1]](https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1279081) [[2]](http://www.spinics.net/lists/linux-usb/msg102504.html)

**Примечание:** Начиная с версии ядра 3.13.6 исправлено [[3]](https://www.kernel.org/pub/linux/kernel/v3.x/ChangeLog-3.13.6)

*   Установим версию ядра реального времени [linux-rt](https://aur.archlinux.org/packages/linux-rt/)
*   Установим значение подсистемы [cpufreq](/index.php/CPU_frequency_scaling_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "CPU frequency scaling (Русский)") в `performance`
*   Добавим `noatime` в [опции монтирования файловой системы](/index.php/Fstab_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Fstab (Русский)") (смотрите раздел [Увеличение производительности#Параметры монтирования](/index.php/%D0%A3%D0%B2%D0%B5%D0%BB%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8#.D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D1.8B_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F "Увеличение производительности"))

Режим реального времени в большинстве случаев уже настроен: для настройки реалтайма больше не нужно редактировать файл `/etc/security/limits.conf`. Однако, если вам необходимо изменить настройки, вы всегда можете это сделать в файлах `/etc/security/limits.d/99-audio.conf` и `/usr/lib/udev/rules.d/40-hpet-permissions.rules` (эти файлы предоставляются пакетами [jack](https://www.archlinux.org/packages/?name=jack) или [jack2](https://www.archlinux.org/packages/?name=jack2)). Кроме того, вы можете повысить частоту прерывания RTC (по умолчанию она равна 64 Гц) через [автозагрузку следующих значений](/index.php/Systemd_FAQ#How_can_I_make_a_script_start_during_the_boot_process.3F "Systemd FAQ"):

```
echo 2048 > /sys/class/rtc/rtc0/max_user_freq
echo 2048 > /proc/sys/dev/hpet/max-user-freq

```

По умолчанию, частота подкачки, определяемая параметром *swappiness* имеет значение 60\. Уменьшив это число до 10, система будет использовать дисковый кэш намного позже: пока свободной памяти в ОЗУ будет оставаться больше 10% — система будет использовать ОЗУ. Кроме того, есть *inotify* , который отслеживает изменения в файлах и сообщает о них приложениям, запрашивающих эту информацию. При работе с большим количеством аудиофайлов много времени уходит на отслеживание изменений в них, поэтому это время можно увеличить. Эти два параметра настраиваются в файле `/etc/sysctl.d/99-sysctl.conf` (при отсутствии его необходимо создать):

```
vm.swappiness = 10
fs.inotify.max_user_watches = 524288

```

Вы также можете увеличить до максимума таймер времени ожидания шины PCI (PCI latency timer, задающий время, которое может занимать карта на шине, если к шине обращаются другие карты) для вашего устройства и, соответственно, немного увеличить его для других устройств PCI (по умолчанию 64).

```
$ setpci -v -d *:* latency_timer=**b0**
$ setpci -v -s *$SOUND_CARD_PCI_ID* latency_timer=**ff** # например SOUND_CARD_PCI_ID=03:00.0 (см. ниже)

```

Значение переменной SOUND_CARD_PCI_ID можно получить так:

 `$ lspci ¦ grep -i audio` 
```
**03:00.0** Multimedia audio controller: Creative Labs SB Audigy (rev 03)
**03:01.0** Multimedia audio controller: VIA Technologies Inc. VT1720/24 [Envy24PT/HT] PCI Multi-Channel Audio Controller (rev 01)
```

#### Проверка настроек

Следующие действия, в основном, необходимы, чтобы ещё раз проверить, что у вас правильно настроена звуковая подсистема:

*   Как проверить работоспособность звука? См. [ALSA](/index.php/ALSA "ALSA") или [OSS](/index.php/OSS "OSS").

```
$ speaker-test

```

*   Находится ли учётная запись в группе *audio*? См. [ALSA](/index.php/ALSA "ALSA") или [OSS](/index.php/OSS "OSS").

```
$ groups | grep audio

```

*   Какая программа или звуковой сервер (Pulseaudio, OSS) захватили звуковое устройство?

```
$ lsof +c 0 /dev/snd/pcm* /dev/dsp*

```

или:

```
$ fuser -fv /dev/snd/pcm* /dev/dsp*  

```

*   Работает ли режим реального времени (realtime) и механизм [PAM-security](http://www.freebsd.org/doc/ru/articles/pam/article.html) правильно?

См.: [Realtime for Users#PAM-enabled login](/index.php/Realtime_for_Users#PAM-enabled_login "Realtime for Users") (Настоятельно рекомендуется к прочтению, особенно, если вы не используете менеджеры входа, такие как KDM, GDM или Slim.)

*   Перезагрузили ли вы компьютер после всех сделанных изменений?

### JACK

Основная цель здесь — это найти самую оптимальную комбинацию отношения размера буфера к величине периодов, предоставленные имеющимся у вас оборудованием. Отношение **Frames/Period = 256** является разумным началом. Для встроенных и USB устройств попробуйте значение **Periods/Buffer = 3**. Основные используемые значения: 256/3, 256/2, 128/3.

Кроме того, частота дискретизации должна соответствовать аппаратной частоте дискретизации. Для проверки поддерживаемой частоты дискретизации и битности:

```
$ cat /proc/asound/card0/codec#0

```

Замените *card0* и *codec#0* своими значениями. Вы увидите значение частоты **rates** или *VRA* в поле **Extended ID**. Общее значение частоты дискретизации во многих современных устройствах - **48000 Hz**. Другие общие значения - это *44100 Hz* и *96000 Hz*.

Практически всегда, когда вы записываете или секвенируете с задействованием внешних механизмов, вам потребуется режим реального времени — **realtime**. Кроме того, вы можете установить максимальный приоритет (по-крайней мере, ниже 10, который ограничивается системой и определяется в файле `/etc/security/limits.d/99-audio.conf`); самый высокий для самого устройства.

Запустите *jack* с опциями, которые вы только что выяснили:

```
$ /usr/bin/jackd -R -P89 -dalsa -dhw:0 -r48000 -p256 -n3

```

[qjackctl](https://www.archlinux.org/packages/?name=qjackctl) и [patchage](https://www.archlinux.org/packages/?name=patchage) - два GUI фронтенда для *jack'*а. Для *jack2 qjackctl* необязателен; лёгкой альтернативы с меньшими возможостями будет вполне достаточно, т.к. программы, такие как *ardour* или *patchage* уже автоматически настраивают клиентские соединения и плавно подстраивают размер буфера.

**Примечание:** Как только вы настроите JACK, попробуйте позапускать различные аудиоприложения для проверки результатов настройки. Я потратил несколько дней, пытаясь решить проблему запуска JACK xrun вместе с LMMS, которая, как оказалось в итоге, была в последней.

*Рекомендуемая литература: [http://w3.linux-magazine.com/issue/67/JACK_Audio_Server.pdf](http://w3.linux-magazine.com/issue/67/JACK_Audio_Server.pdf)*

#### FireWire

**Примечание:** Ничего особенного здесь настраивать не нужно, т.к. большинство настроек уже автоматизированы (особенно [в новом стеке FireWire](https://ieee1394.wiki.kernel.org/articles/j/u/j/Juju_Migration_e8a6.html)) ввиду устаревания подсистемы HAL и сосредоточения внимания на [udev](/index.php/Udev "Udev"). Вам не нужно редактировать права на устройства, но, если вы подозреваете, что ваше устройство испытывает проблемы именно из-за этого, проверьте файл правила udev `/lib/udev/rules.d/60-ffado.rules`, и, если потребуется, создайте новый файл правил `/etc/udev/rules.d/60-ffado.rules` и сохраняйте в него свои изменения. Наиболее вероятно, что ваше устройство заработает с разрабатываемой версией драйвера [libffado-svn](https://aur.archlinux.org/packages/libffado-svn/)

JACK(2) собран с FFADO, вам понадобится только установить пакет [libffado](https://www.archlinux.org/packages/?name=libffado).

Для проверки того, что ваши устройства FireWire настроены и работают как полагается:

*   Убедитесь, что необходимые модули ядра у вас загружены:

```
# modprobe firewire-core firewire-ohci

```

*   Поддерживает ли ваш чипсет работу с данным устройством;

[http://www.ffado.org/?q=node/622](http://www.ffado.org/?q=node/622)

*   Хватает ли мощности вашего чипсета для работы с данным устройством в полном объёме.

Мы не можем гарантировать работу устройств наверняка, в частности, основанных на чипах Ricoh (проблемы с кроссплатформенной совместимостью). В большинстве случаев, ваше устройство заработает сразу, но, порой, вы можете столкнуться с различными забавными ситуациями. В случае же неудачи, — вас ждёт сущий ад.

**Примечание:** Как было замечено Такаши Сакамото(Takashi Sakamoto) [в списке рассылки разработчиков alsa](http://mailman.alsa-project.org/pipermail/alsa-devel/2014-September/081731.html), при использовании бэкенда FireWire совместно с jackd — модуль DICE несовместим. Если вы видите строки вроде этой:
```
Warning (dice_eap.cpp)[1811] read: No routes found. Base 0x7, offset 0x4000

```
то вам необходимо отключить модуль "snd_dice".

#### Jack Flash

После установки JACK, вы можете обнаружить, что во флешплеере у вас отсутствует звук. В таком случае, чтобы заставить работать флешплеер с JACK'ом, вам может понадобиться установить пакет [libflashsupport-jack](https://aur.archlinux.org/packages/libflashsupport-jack/) из [AUR](/index.php/AUR "AUR"). Вы также можете воспользоваться более гибким методом, позволяющий программам, работающим через Alsa (содержащие флеш) проигрывать звук во время работы JACK, установив JACK плагин для Alsa — [alsa-plugins](https://www.archlinux.org/packages/?name=alsa-plugins). Включается плагин через редактирование (или создание) файла `/etc/asound.conf` (глобальные настройки) со следующим содержанием:

```
# конвертируем API alsa в API JACK
# для проверки используйте
# % aplay foo.wav

# используйте это в качестве настройки по умолчанию
pcm.!default {
    type plug
    slave { pcm "jack" }
}

ctl.mixer0 {
    type hw
    card 1
}

# тип pcm: jack
pcm.jack {
    type jack
    playback_ports {
        0 system:playback_1
        1 system:playback_2
    }
    capture_ports {
        0 system:capture_1
        1 system:capture_2
    }
}

```

Вам не понадобится перезагружать компьютер или что-либо ещё. Просто отредактируйте файл настройки Alsa и запустите JACK.

#### Скрипт быстрой проверки Jack (Quickscan)

Вероятно, большинство людей захотят работать с JACK в режиме реального времени; однако, для этого требуется крутить слишком много ручек и настроек. Отличный способ проверить системную конфигурацию после настройки JACK'а — это запустить скрипт Quickscan. Вывод данного скрипта покажет вам узкие места(бутылочное горло) в системе и/или железе, и укажет места, где можно найти более подробную информацию по этому поводу. Скачать его можно [отсюда](https://github.com/raboof/realtimeconfigquickscan/blob/master/realTimeConfigQuickScan.pl), либо установить пакет [realtimeconfigquickscan](https://aur.archlinux.org/packages/realtimeconfigquickscan/).

### Распространённые примеры

Общие примеры настройки доступны в разделе [JACK Audio Connection Kit#A shell-based example setup](/index.php/JACK_Audio_Connection_Kit#A_shell-based_example_setup "JACK Audio Connection Kit").

## Режим реального времени ядра

С недавнего времени основное ядро Linux предоставляет хорошие возможности для использования его в режиме реального времени. Основное ядро (с параметром `CONFIG_PREEMPT=y`, используемое в Арч по умолчанию) в худшем случае может работать с задержкой [до 10мс](https://rt.wiki.kernel.org/index.php/Frequently_Asked_Questions#What_are_real-time_capabilities_of_the_stock_2.6_linux_kernel.3F) (время между моментом аппаратного прерывания и моментом, соответствующим получению прерывания выполняющимся потоком), хотя, конечно же, некоторые драйверы устройств могут внести задержки намного бо́льшие, чем системные. В зависимости от вашего аппаратного обеспечения и драйверов (и требований), вы, возможно, захотите ядро с возможностями жёсткого режима реального времени.

Патч [RT_PREEPMT](https://rt.wiki.kernel.org/index.php/RT_PREEMPT_HOWTO) от Инго Молнара (Ingo Molnar) и Томаса Глейкснера (Thomas Gleixner) является интересным вариантом для жёстких задержек и приложений режима реального времени, достигаемых в профессиональном аудио промышленного масштаба. Большинство аудио специфичных дистрибутивов Linux поставляются с применением данного патча. Режим вытесняющей многозадачности реального времени ядра также позволяет настроить приоритеты прерываний (IRQ) обработки потоков и помогает обеспечить плавный звук почти независимо от нагрузки.

Если вы собираетесь компилировать собственное ядро, помните, что удаление модулей/опций не следует приравнивать к «лёгкости и простоте» ядра. Образ ядра, конечно же, уменьшится, но в современных системах это не такая проблема, какая она была в 1995-м.

В любом случае, вы должны обеспечить следующие параметры:

*   **Timer Frequency** установить в значение **1000Hz** (CONFIG_HZ_1000=y; если вы не задаёте *MIDI*, вы можете это игнорировать)
*   **APM** в значение **DISABLED** (CONFIG_APM=n; Могут быть трудности с некоторым оборудованием - по умолчанию в x86_64)

Если вы хотите действительно лёгкую систему, мы предлагаем вам пойти своим путём и развернуть систему один раз с статической аппаратной поддержкой. Однако, вам понадобится выбрать архитектуру процессора. Выбор «Core 2 Duo» с подбором соответствующего аппаратного обеспечения может послужить хорошим подспорьем для оптимизации; но тем меньше будет выигрыш, чем ниже архитектура.

Основные проблемы с режимом реального времени ядра:

*   Гиперпоточность (hyperthreading) (если имеются подозрения, отключите в BIOS)

Также имеются готовые скомпилированные с патчами ядра, доступные в ABS и AUR.

**Примечание:** Прежде чем вы решите использовать патченное ядро, загляните по ссылке: [http://jackaudio.org/faq/realtime_vs_realtime_kernel.html (англ.)](http://jackaudio.org/faq/realtime_vs_realtime_kernel.html).

### ABS

Вы можете использовать [ABS](/index.php/ABS "ABS") для перекомпиляции [linux](https://www.archlinux.org/packages/?name=linux) с патчами. Тем не менее, это не самый лучший способ, т.к. обновление перезапишет ваше ядро (по крайней мере, вам нужно добавить параметр `IgnorePkg=linux` в файл `/etc/pacman.conf`).

### AUR

Из [AUR](/index.php/AUR "AUR") вы можете выбрать следующее:

*   [linux-rt](https://aur.archlinux.org/packages/linux-rt/)
*   [linux-rt-lts](https://aur.archlinux.org/packages/linux-rt-lts/) (длительная поддержка, стабильный релиз)
*   [linux-rt-ice](https://aur.archlinux.org/packages/linux-rt-ice/)

Первые два являются стандартным ядром с включённым патчем CONFIG_PREEMPT_RT, в то время как -ice включают в себя патчи, которые некоторым могут не понравиться, но другим будут по вкусу.

	*См.: [Real-Time Linux Wiki (англ.)](https://rt.wiki.kernel.org/)*

## MIDI

Для работы с MIDI настоятельно рекомендуется установить пакет a2j ([a2jmidid](https://www.archlinux.org/packages/?name=a2jmidid)), являющийся мостом между alsa midi и jack midi. Он позволяет подключаться друг к другу приложениям, работающим исключительно с alsa midi к приложениям, которые работают только через jack midi. Laditray способен также запускать/останавливать a2j.

	*См.: [JACK#MIDI](/index.php/JACK#MIDI "JACK")*

## Переменные окружения

Если вы устанавливаете что-либо в нестандартные директории, часто бывает необходимо задать переменную окружения пути, чтобы приложения могли найти требуемые объекты (например, плагины и сторонние библиотеки). Это, как правило, относится к плагинам VST, т.к. пользователи могут работать через Wine или работать с внешними окружениями Windows.

В Linux обычно нет плагинов, располагающихся вне стандартных путей (LADSPA, LV2, DSSI, LXVST), поэтому нет необходимости экспортировать их. Но, если вы всё же делаете это, не забудьте включить эти стандартные пути, поскольку Arch ничего не знает о *dssi* или *ladspa*, и некоторые приложения, такие как *dssi-vst* не будут видны из других приложений даже если они находятся в стандартных расположениях.

 `~/.bashrc` 
```
...
export VST_PATH=/usr/lib/vst:/usr/local/lib/vst:~/.vst:/некоторая/нестандартная/директория
export LXVST_PATH=/usr/lib/lxvst:/usr/local/lib/lxvst:~/.lxvst:/некоторая/нестандартная/директория
export LADSPA_PATH=/usr/lib/ladspa:/usr/local/lib/ladspa:~/.ladspa:/некоторая/нестандартная/директория
export LV2_PATH=/usr/lib/lv2:/usr/local/lib/lv2:~/.lv2:/некоторая/нестандартная/директория
export DSSI_PATH=/usr/lib/dssi:/usr/local/lib/dssi:~/.dssi:/некоторая/нестандартная/директория
```

## Советы и рекомендации

*   Возможен конфликт IRQ, вследствие чего могут возникать проблемы. Например, графическое оборудование резервирует системную шину, в результате чего появляются излишние ненужные прерывания в системных путях ввода-вывода. См. обсуждение: [FFADO IRQ Priorities How-To](http://subversion.ffado.org/wiki/IrqPriorities). Если у вас имеется режим реального времени либо установлено ядро последней версии, вы можете использовать пакет [rtirq](https://www.archlinux.org/packages/?name=rtirq) для регулировки приоритетов IRQ обработки потоков.

*   Не используйте службу **irqbalance**, либо делайте это с осторожностью; подробнее:[[4]](http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_MRG/1.3/html/Realtime_Tuning_Guide/sect-Realtime_Tuning_Guide-General_System_Tuning-Interrupt_and_Process_Binding.html).

*   Некоторые службы/процессы могут неожиданно порождать **xruns**. Если эти службы вам не нужны — завершайте их. Без вопросов.

```
$ ls /var/run/daemons
$ top # или htop, ps aux, что ещё вам удобнее
$ killall -9 $processname
# systemctl stop $daemonname

```

*   Если вы сталкиваетесь с множеством *xruns*, особенно с [nvidia](https://www.archlinux.org/packages/?name=nvidia), отключите управление производительностью GPU. Это может быть сделано через апплет управления видеокарты и для nvidia это т.н. "режим максимальной производительности" (благодаря сообщению в LAU Фрэнка Кобера (Frank Kober)).

*   Также, за дополнительной информацией по ALSA, вы можете обратиться по адресу: [http://www.volkerschatz.com/noise/alsa.html](http://www.volkerschatz.com/noise/alsa.html)

## Оборудование

### M-Audio Delta 1010

Карты серии M-Audio Delta построены на базе аудиочипсета VIA Ice1712. Карты, использующие данный чипсет требуют установки пакета alsa-tools, потому что пакет содержит программу [envy24control](/index.php/Envy24control "Envy24control"). Envy24control — это микшер/контро́ллер аппаратного уровня. Вы, конечно, *можете* использовать alsa-mixer, но вы спасёте себя от некоторых хлопот; не стоит пробовать это. Обратите внимание, что данный раздел никак не описывает настройку и использование MIDI.

Запустите приложение микшера:

```
$ envy24control

```

Данное приложение может быть чуть более чем немного запутанным; см. руководство к использованию в [envy24control](/index.php/Envy24control "Envy24control"). Там описана лёгкая настройка программы для многоканальной работы в Ardour.

1.  На вкладках "Monitor Inputs" и "Monitor PCMs", установите все входы монитора и монитор ИКМ'ов ([Импульсно-кодовая модуляция](https://ru.wikipedia.org/wiki/%D0%98%D0%BC%D0%BF%D1%83%D0%BB%D1%8C%D1%81%D0%BD%D0%BE-%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2%D0%B0%D1%8F_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F%D1%86%D0%B8%D1%8F) англ. Pulse Code Modulation, PCM) в значение около 20.
2.  На вкладке "Patchbay / Router", установите всё на выход PCM.
3.  На вкладке "Hardware Settings", убедитесь, что значение Master Clock соответствует тому что установлено в Qjackctl. Если они не совпадают, то xruns у вас выйдет из-под контроля!

### M-Audio Fast Track Pro

M-Audio Fast Track Pro является профессиональной звуковой картой с интерфейсом USB v1.1 и 4x4 аудио входами, работающая с частотой дискретизации 24 бит/96 кГц при использовании только двух входов или двух выходов. В силу ограничений, накладываемых USB v1.1, это устройство требует дополнительной настройки для получения доступа ко всем его возможностям. Устройство работает в одном из двух конфигураций:

*   1-я конфигурация, или "Режим соответствия классу" — с урезанной функциональностью, только 16 бит, 48 кГц, аналоговым входом (2 канала) и цифровым/аналоговым выходом (4 канала);
*   2-я конфигурация — с доступом ко всем функциям интерфейса.

В настоящее время с основным ядром она работает во 2-ой конфигурации, но, если вы всё же хотите убедиться, в каком режиме карта работает в данный момент, — вы можете проверить журнал ядра на записи:

```
usb-audio: Fast Track Pro switching to config #2
usb-audio: Fast Track Pro config OK

```

Интерфейс также нуждается в дополнительном этапе настройки для переключения режимов. Это делается с помощью опции `device_setup` во время загрузки модуля. Рекомендуемый способ настройки интерфейса с использованием файла в `modprobe.d`:

 `/etc/modprobe.d/ftp.conf` 
```
options snd_usb_audio vid=0x763 pid=0x2012 device_setup=XXX index=YYY enable=1

```

где `vid` и `pid` — идентификационный код производителя и изделия ([Vendor ID, Product ID](https://ru.wikipedia.org/wiki/PCI_configuration_space)) для M-Audio Fast Track Pro, `index` — желаемый номер устройства и `device_setup` — желаемая настройка устройства. Возможные значения для `device_setup` следующие:

<caption>режимы устройства</caption>
| значение device_setup | разрядность бит | частота | аналоговый выход | цифровой выход | аналоговый вход | цифровой вход | режим ввода-вывода |
| 0x0 | 16 бит | 48 кГц | + | + | + | + | 4x4 |
| 0x9 | 24 бит | 48 кГц | + | + | + | - | 2x4 |
| 0x13 | 24 бит | 48 кГц | + | + | - | + | 2x4 |
| 0x5 | 24 бит | 96 кГц | * | * | * | * | 2x0 или 0x2 |

Режим 24 бит/96 кГц особенный: он предоставляет все вводы/выводы, но вы можете использовать только один из четырёх интерфейсов одновременно. Если вы, например, открыли выходной интерфейс и затем попытаетесь одновременно открыть второй входной или выходной интерфейс, вы получите ошибку в журнале ядра:

```
cannot submit datapipe for usb 0, error -28: not enough bandwidth
(перев.: невозможно предоставить канал данных для usb 0, ошибка -28: нехватка пропускной способности) 

```

что является нормальным, ибо карта — USB v1.1 — и данный режим интерфейса неспособен обеспечить достаточную пропускную способность для поддержки более чем одного (2-х каналов) назначения/источника ([полнодуплексный режим](https://ru.wikipedia.org/wiki/%D0%94%D1%83%D0%BF%D0%BB%D0%B5%D0%BA%D1%81_(%D1%82%D0%B5%D0%BB%D0%B5%D0%BA%D0%BE%D0%BC%D0%BC%D1%83%D0%BD%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8))) с приемлемым качеством одновременно.

В зависимости от значения `index` будет установлено два устройства: `hwYYY:0` и `hwYYY:1`, которые будут содержать доступные входы и выходы. Первое устройство, скорее всего, будет содержать в себе аналоговый выход и цифровой вход, в то время как второй — аналоговый вход и цифровой выход. Чтобы узнать, где и как устройства соединены, — если они настроены правильно, — вы можете проверить `/proc/asound/cardYYY/stream{0,1}` . Ниже приведён список наиболее важных конечных точек (endpoints), которые помогут правильно определить соединения карты (легко перепутать аналоговые и цифровые входные или выходные соединения, прежде чем привыкаешь к устройству):

```
EP 3 (аналоговый выход (analogue output) = разъём TRS задней панели зеркально отображается на выходах RCA 1 и 2 задней панели)
EP 4 (цифровой выход (digital output) = выход S/PDIF задней панели зеркально отображается на выходах RCA 3 и 4 задней панели)
EP 5 (аналоговый вход (analogue input) = балансный разъём TRS или XLR микрофона, небалансная линия TS на передней панели)
EP 6 (цифровой вход (digital input) = вход S/PDIF задней панели)

```

### PreSonus Firepod

1.  Запуск: либо из командной строки, либо Qjackctl; драйвер называется firewire.
2.  Характеристики: карта содержит 8/8 XLR предусилителей плюс стереопара, итого получается 10 каналов.
3.  Сопряжение: карты могут соединяться вместе без каких-либо проблем.
4.  Настройка оборудования: ничего особенного; меняйте настройки в Qjackctl по своему усмотрению.

Уровни громкости аппаратные, а маршрутизация может быть выполнена в Qjackctl, даже если между собой сопряжено множество карт, — это не проблема. Ffadomixer пока ещё не работает с данной картой; надеемся, в будущем мы сможем контролировать больше аспектов карты через программный интерфейс как этот.

### PreSonus AudioBox USB

1.  Запуск: ALSA даёт ему название "USB".
2.  Характеристики: два входных разъёма моно TRS+XLR, два выхода моно TRS, входной и выходной разъёмы MIDI, плюс отдельный разъём для стереонаушников. Ручки управления для обоих входов, для главного выхода и для наушников — всего четыре.
3.  Оборудование: работает очень хорошо, аудио и MIDI тоже. Программного управления микшером нет вообще.

## Несвободные приложения

### Steinberg'овые SDK

Естественно, мы не можем распространять заголовки ни VST, ни ASIO в форме бинарных пакетов. Тем не менее, всякий раз, когда вы собираете программу, которая будет работать с плагинами VST в виде Windows-библиотек *.dll*, проверьте следующие пакеты (которые не требуют использования какого-либо SDK):

*   dssi-vst
*   fst
*   vestige

С учётом вышесказанного, если вы собираете программу, которая будет работать с нативными *.so* VST плагинами, то в этом случае выхода нет. Для таких случаев Арч позволяет нам поддерживать единую локальную базу данных приложений. Мы можем «установить» общесистемную SDK — достаточно лишь скачать и поместить файл в директорию установленного пакета.

[Получить их можно в AUR](https://aur.archlinux.org/packages.php?O=0&K=steinberg-&do_Search=)

**Примечание:** *Steinberg не запрещает распространять конечные продукты и не диктует лицензию, под которой они должны распространяться. Существует много плагинов с лицензией GPL. Таким образом, распространение бинарных пакетов или программного обеспечения, собранного с данными несвободными заголовками не проблема, потому что заголовки являются лишь временными зависимостями для сборки.*

## Проект Arch Linux Pro Audio

Да, у нас есть и такое. Задумайтесь над "Planet CCRMA" или "Pro Audio Overlay", меньше научной коннотации: [ArchAudio](http://archaudio.org).

Что значит, что сие является репозиторием дополнений, т.е. вы должны поработать над разумной установкой и настройкой Archlinux.

Это относительно новое течение, хотя инициатива была проявлена ещё примерно в 2006/2007г.

История: [https://bbs.archlinux.org/viewtopic.php?id=30547](https://bbs.archlinux.org/viewtopic.php?id=30547)

По всем вопросам, связанными с Arch- и ArchAudio- проблемами можно обратиться в наш **IRC**: #archaudio @ Freenode

## Linux и Arch Linux Pro Audio в новостях

*   [Cтроим серьёзную мультимедиа станцию с Arch](https://www.linux.com/learn/tutorials/607117-build-a-serious-multimedia-production-workstation-with-arch-linux) — статья на Linux.com, июль 2012 (англ.)

*   [Повесть об Арче](http://www.linuxjournal.com/content/arch-tale) — статья музыканта и писателя Дэйва Филлипса (Dave Phillips), октябрь 2011 (англ.)

*   [От Windows к Linux: правильное решение](http://www.itwire.com/opinion-and-analysis/open-sauce/36698-from-windows-to-linux-a-sound-decision) — интервью Geoff "songshop" Beasley, февраль 2010 (англ.)