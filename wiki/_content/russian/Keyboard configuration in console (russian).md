**Состояние перевода:** На этой странице представлен перевод статьи [Keyboard configuration in console](/index.php/Keyboard_configuration_in_console "Keyboard configuration in console"). Дата последней синхронизации: 26 июля 2018\. Вы можете [помочь](/index.php/ArchWiki_Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ArchWiki Translation Team (Русский)") синхронизировать перевод, если в английской версии произошли [изменения](https://wiki.archlinux.org/index.php?title=Keyboard_configuration_in_console&diff=0&oldid=531027).

Ссылки по теме

*   [Конфигурация клавиатуры в Xorg](/index.php/%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F_%D0%BA%D0%BB%D0%B0%D0%B2%D0%B8%D0%B0%D1%82%D1%83%D1%80%D1%8B_%D0%B2_Xorg "Конфигурация клавиатуры в Xorg")
*   [Дополнительные клавиши](/index.php/%D0%94%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%BA%D0%BB%D0%B0%D0%B2%D0%B8%D1%88%D0%B8 "Дополнительные клавиши")
*   [Шрифты#Шрифт в консоли](/index.php/%D0%A8%D1%80%D0%B8%D1%84%D1%82%D1%8B#.D0.A8.D1.80.D0.B8.D1.84.D1.82_.D0.B2_.D0.BA.D0.BE.D0.BD.D1.81.D0.BE.D0.BB.D0.B8 "Шрифты")

Сопоставление клавиш (раскладки) для [виртуальной консоли](https://en.wikipedia.org/wiki/ru:%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D0%BA%D0%BE%D0%BD%D1%81%D0%BE%D0%BB%D1%8C "w:ru:Виртуальная консоль"), консольных шрифтов и консольных карт предоставляется пакетом [kbd](https://www.archlinux.org/packages/?name=kbd) (зависимость для [systemd](/index.php/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Systemd (Русский)")), который также предоставляет множество инструментов низкого уровня для управления виртуальной консолью. Кроме того, *systemd* также предоставляет инструмент *localectl*, который может контролировать как [локали](/index.php/Locale_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Locale (Русский)") системы, так и настройки раскладки клавиатуры как для виртуальной консоли, так и для Xorg.

## Contents

*   [1 Просмотр настроек клавиатуры](#.D0.9F.D1.80.D0.BE.D1.81.D0.BC.D0.BE.D1.82.D1.80_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B5.D0.BA_.D0.BA.D0.BB.D0.B0.D0.B2.D0.B8.D0.B0.D1.82.D1.83.D1.80.D1.8B)
*   [2 Раскладки клавиатуры](#.D0.A0.D0.B0.D1.81.D0.BA.D0.BB.D0.B0.D0.B4.D0.BA.D0.B8_.D0.BA.D0.BB.D0.B0.D0.B2.D0.B8.D0.B0.D1.82.D1.83.D1.80.D1.8B)
    *   [2.1 Список раскладок](#.D0.A1.D0.BF.D0.B8.D1.81.D0.BE.D0.BA_.D1.80.D0.B0.D1.81.D0.BA.D0.BB.D0.B0.D0.B4.D0.BE.D0.BA)
    *   [2.2 Временная конфигурация (Loadkeys)](#.D0.92.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D0.B0.D1.8F_.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F_.28Loadkeys.29)
    *   [2.3 Постоянная конфигурация](#.D0.9F.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.BD.D0.B0.D1.8F_.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F)
    *   [2.4 Создание своей раскладки](#.D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81.D0.B2.D0.BE.D0.B5.D0.B9_.D1.80.D0.B0.D1.81.D0.BA.D0.BB.D0.B0.D0.B4.D0.BA.D0.B8)
        *   [2.4.1 Добавление директив](#.D0.94.D0.BE.D0.B1.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D0.B8.D1.80.D0.B5.D0.BA.D1.82.D0.B8.D0.B2)
        *   [2.4.2 Другие примеры](#.D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BF.D1.80.D0.B8.D0.BC.D0.B5.D1.80.D1.8B)
        *   [2.4.3 Сохранение изменений](#.D0.A1.D0.BE.D1.85.D1.80.D0.B0.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B9)
*   [3 Регулировка задержки и скорости автоповтора](#.D0.A0.D0.B5.D0.B3.D1.83.D0.BB.D0.B8.D1.80.D0.BE.D0.B2.D0.BA.D0.B0_.D0.B7.D0.B0.D0.B4.D0.B5.D1.80.D0.B6.D0.BA.D0.B8_.D0.B8_.D1.81.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D0.B8_.D0.B0.D0.B2.D1.82.D0.BE.D0.BF.D0.BE.D0.B2.D1.82.D0.BE.D1.80.D0.B0)
    *   [3.1 Служба systemd](#.D0.A1.D0.BB.D1.83.D0.B6.D0.B1.D0.B0_systemd)

## Просмотр настроек клавиатуры

Используйте `localectl status` для просмотра текущих конфигураций клавиатуры.

## Раскладки клавиатуры

Файлы раскладок хранятся в дереве каталогов `/usr/share/kbd/keymaps/`. Обычно один файл keymap соответствует одной раскладке клавиатуры (оператор `include` может использоваться для совместного использования общих частей, а файл keymap может содержать несколько схем с некоторой комбинацией клавиш, используемой для переключения). Для получения дополнительной информации смотрите [keymaps(5)](https://jlk.fjfi.cvut.cz/arch/manpages/man/keymaps.5).

### Список раскладок

Соглашения об именах консольных раскладок несколько условны, но обычно они основаны на:

*   [Коды языков](https://en.wikipedia.org/wiki/ru:ISO_639-1 "w:ru:ISO 639-1"): где код языка совпадает с кодом страны (например, `ru` для русского языка или `fr` для французского языка).
*   [Коды стран](https://en.wikipedia.org/wiki/ru:%D0%9A%D0%BE%D0%B4_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D1%8B "w:ru:Код страны"): где варианты одного и того же языка используются в разных странах (например, `uk` для английского языка в Великобритании или `us` для Соединенных Штатов Америки); список кодов стран также можно найти в [w:ru:ISO 3166-1#Список кодов по ISO 3166](https://en.wikipedia.org/wiki/ru:ISO_3166-1#.D0.A1.D0.BF.D0.B8.D1.81.D0.BE.D0.BA_.D0.BA.D0.BE.D0.B4.D0.BE.D0.B2_.D0.BF.D0.BE_ISO_3166 "w:ru:ISO 3166-1").
*   [Раскладка клавиатуры](https://en.wikipedia.org/wiki/ru:%D0%A0%D0%B0%D1%81%D0%BA%D0%BB%D0%B0%D0%B4%D0%BA%D0%B0_%D0%BA%D0%BB%D0%B0%D0%B2%D0%B8%D0%B0%D1%82%D1%83%D1%80%D1%8B "w:ru:Раскладка клавиатуры"): где раскладка не связана с конкретной страной или языком (например, `dvorak` для [раскладки клавиатуры Dvorak](https://en.wikipedia.org/wiki/ru:%D0%9A%D0%BB%D0%B0%D0%B2%D0%B8%D0%B0%D1%82%D1%83%D1%80%D0%B0_%D0%94%D0%B2%D0%BE%D1%80%D0%B0%D0%BA%D0%B0 "w:ru:Клавиатура Дворака")).

Для получения списка всех доступных раскладок используйте команду:

```
$ localectl list-keymaps

```

Чтобы найти раскладку клавиатуры, используйте следующую команду, заменив `*search_term*` кодом для вашего языка, страны или раскладки:

```
$ localectl list-keymaps | grep -i *search_term*

```

Альтернативно, используя find:

```
$ find /usr/share/kbd/keymaps/ -type f

```

### Временная конфигурация (Loadkeys)

Можно установить раскладку только для текущего сеанса. Это полезно при проверке различных раскладок, решение проблем и т.д.

Для этого используют инструмент *loadkeys*. Он используется внутри [systemd](/index.php/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Systemd (Русский)") при загрузке раскладки клавиатуры, настроенной в `/etc/vconsole.conf`. Пользоваться им легко:

```
# loadkeys *раскладка_клавиатуры*

```

Для получения дополнительной информации смотрите [loadkeys(1)](https://jlk.fjfi.cvut.cz/arch/manpages/man/loadkeys.1).

### Постоянная конфигурация

Постоянную комбинацию клавиш можно установить в `/etc/vconsole.conf`, которая считывается [systemd](/index.php/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Systemd (Русский)") при запуске. Для указания раскладки используется переменная `KEYMAP`. Если переменная пуста или не установлена, в качестве значения по умолчанию используется раскладка `us`. Смотрите [vconsole.conf(5)](https://jlk.fjfi.cvut.cz/arch/manpages/man/vconsole.conf.5) для получения информации обо всех параметрах. Например:

 `/etc/vconsole.conf` 
```
KEYMAP=ru
...

```

Для удобства, *localectl* можно использовать для настройки раскладки клавиатуры. Он изменит переменную `KEYMAP` в `/etc/vconsole.conf`, а также установит раскладку для текущего сеанса:

```
$ localectl set-keymap --no-convert *раскладка_клавиатуры*

```

Опцию `--no-convert` можно использовать для предотвращения `localectl` автоматического изменения [раскладки клавиатуры в Xorg](/index.php/Keyboard_configuration_in_Xorg_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Keyboard configuration in Xorg (Русский)") до ближайшего совпадения. Для получения дополнительной информации смотрите [localectl(1)](https://jlk.fjfi.cvut.cz/arch/manpages/man/localectl.1).

### Создание своей раскладки

Вы используете горячие клавиши для вывода особенных символов, пользуясь консолью. Кроме того, мы можем также напечатать последовательность символов и некоторые escape-последовательности. Таким образом, если мы печатаем последовательность символов, составляющих команду, а затем escape-символ для новой строки, эта команда будет выполнена.

Один из способов сделать это - отредактировать файл раскладки. Однако, поскольку он будет перезаписан в любое время, когда пакет, к которому он принадлежит, обновляется, редактирование этого файла не рекомендуется. Лучше объединить существующую раскладку со своей. Утилита `loadkeys` может сделать это.

Сначала, создайте файл раскладки. Этот файл раскладки может быть где угодно, но этот способ подражает иерархии каталогов в `/usr/local`:

```
# mkdir -p /usr/local/share/kbd/keymaps
# vim /usr/local/share/kbd/keymaps/personal.map

```

В качестве примечания следует отметить, что личная раскладка также полезна для переопределения поведения клавиш, уже обработанных стандартной раскладкой: при загрузке с помощью `loadkeys` директивы в стандартной раскладке будут заменены при конфликте с новыми директивами и сохраняются в противном случае. Таким образом, только изменения в раскладке должны быть указаны в личной раскладке.

**Совет:** Также вы можете изменить существующую раскладку, расположенную в дереве каталогов `/usr/share/kbd/keymaps/`. Раскладка имеет расширение *.map.gz*, например Американская раскладка - `us.map.gz`. Просто скопируйте раскладку в `/usr/local/share/kbd/keymaps/personal.map.gz` и *распакуйте*.

#### Добавление директив

**Примечание:**

*   Keycode - это номер генерируемый вашей клавиатурой при нажатии на определенную клавишу. Например, кнопка пробела сгенерирует Keycode=128.
*   Keysym - это просто слово используемое для обозначения типа клавиши. Эта концепция очень важна, потому как позволяет программам не оперировать с кодами напрямую, а работать с клавиатурой по названиям клавишь.

В этой личной раскладке требуются два типа директив. Прежде всего директивы [keycode](/index.php/%D0%94%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%BA%D0%BB%D0%B0%D0%B2%D0%B8%D1%88%D0%B8 "Дополнительные клавиши"), которые соответствуют формату, указанному в стандартных раскладках по умолчанию. Эти директивы сопоставляют keycode с keysym. Keysyms представляют действия клавиатуры. Доступные действия включают вывод кодов символов или последовательностей символов, переключение консолей или раскладок клавиатуры, загрузку машины и многие другие действия. Полную активную текущую раскладку можно получить с помощью

```
# dumpkeys -l

```

Большинство keysyms интуитивно понятны. Например, чтобы настроить клавишу 112 для вывода символа 'e', директива примет следующий вид:

```
keycode 112  = e

```

Чтобы настроить клавишу 112 для вывода символа евро, директива будет следующего вида:

```
keycode 112 = euro

```

Некоторые keysym не сразу связаны с действиями клавиатуры. В частности, keysyms с префиксом заглавной буквы F и от одной до трех цифр (F1-F246), составляющие число больше 30, всегда свободны. Это полезно для указания горячей клавиши для вывода последовательности символов и других действий:

```
keycode 112 = F70

```

Затем F70 может быть связан для вывода определенной строки:

```
string F70 = "Hello"

```

Когда клавиша 112 нажата, она выведет содержимое F70\. Чтобы выполнить команду в терминале, символ окончания новой строки должен быть добавлен в конец строки с командой. Например, чтобы ввести систему в спящий режим, добавляется следующая строка в раскладку:

```
string F70 = "sudo /usr/sbin/hibernate
"

```

#### Другие примеры

*   Чтобы сделать клавишу Правый Alt такой же как клавиша Левый Alt (для Emacs), используй следующую строку в своей раскладке. Это включит файл `/usr/share/kbd/keymaps/i386/include/linux-with-two-alt-keys.inc`, посмотри его для получения дополнительной информации.

include "linux-with-two-alt-keys"

*   Чтобы поменять местами CapsLock и Escape (для Vim), выполните переназначение соответствующих кодов клавиш:

```
keycode 1 = Caps_Lock
keycode 58 = Escape

```

*   Чтобы сделать CapsLock еще одним Control, выполните переназначение соответствующих кодов клавиш:

```
keycode 58 = Control

```

*   Чтобы поменять местами CapsLock и Левый Control, выполните переназначение соответствующих кодов клавиш:

```
keycode 29 = Caps_Lock
keycode 58 = Control

```

#### Сохранение изменений

Чтобы использовать свою раскладку, нужно ее загрузить с помощью *loadkeys*:

```
$ loadkeys /usr/local/share/kbd/keymaps/personal.map

```

Однако, эта раскладка активна только для текущего сеанса. Чтобы загрузить ее при загрузке, укажите полный путь файла вашей раскладки в переменной `KEYMAP` в [/etc/vconsole.conf](#.D0.9F.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.BD.D0.B0.D1.8F_.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F). Файл не должен быть запакован, как официальные раскладки, представленные [kbd](https://www.archlinux.org/packages/?name=kbd).

## Регулировка задержки и скорости автоповтора

*Задержка автоповтора* означает количество времени (обычно в милисекундах), за которое необходимо нажать и удерживать клавишу для начала повторного процесса. После запуска повторяющегося процесса символ будет повторяться с определенной частотой (обычно заданной в Гц), указанной *скоростью автоповтора*. Эти значения могут быть изменены с помощью команды *kbdrate*. Обратите внимание, что эти настройки настраиваются отдельно для виртуальной консоли и [для Xorg](/index.php/%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F_%D0%BA%D0%BB%D0%B0%D0%B2%D0%B8%D0%B0%D1%82%D1%83%D1%80%D1%8B_%D0%B2_Xorg#.D0.A0.D0.B5.D0.B3.D1.83.D0.BB.D0.B8.D1.80.D0.BE.D0.B2.D0.BA.D0.B0_.D0.B7.D0.B0.D0.B4.D0.B5.D1.80.D0.B6.D0.BA.D0.B8_.D0.B8_.D1.81.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D0.B8_.D0.B0.D0.B2.D1.82.D0.BE.D0.BF.D0.BE.D0.B2.D1.82.D0.BE.D1.80.D0.B0 "Конфигурация клавиатуры в Xorg").

```
# kbdrate [-d *delay*] [-r *rate*]

```

Например, чтобы установить задержку автоповтора в 200 мс и скорость автоповтора в 30 Гц, используйте следующую команду:

```
# kbdrate -d 200 -r 30

```

Ввод команды без указания задержки и скорости автоповтора приведет к сбросу значений до их соответствующих значений по умолчанию; задержка 250 мс и скорость 11 Гц:

```
# kbdrate

```

### Служба systemd

Службу systemd можно использовать для установки скорости клавиатуры. Например

 `/etc/systemd/system/kbdrate.service` 
```

[Unit]
Description=Keyboard repeat rate in tty.

[Service]
Type=oneshot
RemainAfterExit=yes
StandardInput=tty
StandardOutput=tty
ExecStart=/usr/bin/kbdrate -s -d 450 -r 60

[Install]
WantedBy=multi-user.target

```

Затем [запустите/включите](/index.php/%D0%97%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D0%B5/%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D0%B5 "Запустите/включите") службу systemd `kbdrate.service`.