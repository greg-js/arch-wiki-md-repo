Related articles

*   [NFS/Troubleshooting](/index.php/NFS/Troubleshooting "NFS/Troubleshooting")

From [Wikipedia](https://en.wikipedia.org/wiki/Network_File_System "wikipedia:Network File System"):

	*Сетевая файловая система (NFS) - это протокол распределенной файловой системы, первоначально разработанный Sun Microsystems в 1984 году, позволяющий пользователю на клиентском компьютере получать доступ к файлам по сети таким же образом, как и к доступу к локальному хранилищу.*

**Примечание:**

*   NFS не зашифрован. При работе с конфиденциальными данными чтобы шифровать протокол NFS нужно использовать туннель, например [Kerberos](/index.php/Kerberos "Kerberos") или [tinc](/index.php/Tinc "Tinc").
*   В отличие от [Samba](/index.php/Samba "Samba"), NFS по умолчанию не имеет аутентификации пользователя, доступ к клиенту ограничен по их IP-адресам / [hostname](/index.php/Hostname "Hostname").

## Contents

*   [1 Установка](#.D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0)
*   [2 Конфигурация](#.D0.9A.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F)
    *   [2.1 Сервер](#.D0.A1.D0.B5.D1.80.D0.B2.D0.B5.D1.80)
        *   [2.1.1 Запуск сервера](#.D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D0.B0)
        *   [2.1.2 Разное](#.D0.A0.D0.B0.D0.B7.D0.BD.D0.BE.D0.B5)
            *   [2.1.2.1 Дополнительная конфигурация](#.D0.94.D0.BE.D0.BF.D0.BE.D0.BB.D0.BD.D0.B8.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D0.B0.D1.8F_.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F)
            *   [2.1.2.2 Ограничение NFS для интерфейсов/IP](#.D0.9E.D0.B3.D1.80.D0.B0.D0.BD.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_NFS_.D0.B4.D0.BB.D1.8F_.D0.B8.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81.D0.BE.D0.B2.2FIP)
            *   [2.1.2.3 Убедиться что NFSv4 idmapping полностью включена](#.D0.A3.D0.B1.D0.B5.D0.B4.D0.B8.D1.82.D1.8C.D1.81.D1.8F_.D1.87.D1.82.D0.BE_NFSv4_idmapping_.D0.BF.D0.BE.D0.BB.D0.BD.D0.BE.D1.81.D1.82.D1.8C.D1.8E_.D0.B2.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B0)
            *   [2.1.2.4 Статические порты для NFSv3](#.D0.A1.D1.82.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D0.BF.D0.BE.D1.80.D1.82.D1.8B_.D0.B4.D0.BB.D1.8F_NFSv3)
            *   [2.1.2.5 Совместимость NFSv2](#.D0.A1.D0.BE.D0.B2.D0.BC.D0.B5.D1.81.D1.82.D0.B8.D0.BC.D0.BE.D1.81.D1.82.D1.8C_NFSv2)
            *   [2.1.2.6 Конфигурация брандмауэра](#.D0.9A.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F_.D0.B1.D1.80.D0.B0.D0.BD.D0.B4.D0.BC.D0.B0.D1.83.D1.8D.D1.80.D0.B0)
    *   [2.2 Клиент](#.D0.9A.D0.BB.D0.B8.D0.B5.D0.BD.D1.82)
        *   [2.2.1 Ручная установка](#.D0.A0.D1.83.D1.87.D0.BD.D0.B0.D1.8F_.D1.83.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0)
        *   [2.2.2 Монтирование с использованием /etc/fstab](#.D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5.D0.BC_.2Fetc.2Ffstab)
        *   [2.2.3 Монтирование с использованием /etc/fstab с systemd](#.D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5.D0.BC_.2Fetc.2Ffstab_.D1.81_systemd)
    *   [2.3 Файлы](#.D0.A4.D0.B0.D0.B9.D0.BB.D1.8B)
        *   [2.3.1 /etc/exports](#.2Fetc.2Fexports)
        *   [2.3.2 /etc/hosts.allow](#.2Fetc.2Fhosts.allow)
    *   [2.4 Демоны](#.D0.94.D0.B5.D0.BC.D0.BE.D0.BD.D1.8B)
*   [3 Настройка клиента](#.D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B0)
    *   [3.1 /etc/hosts.allow](#.2Fetc.2Fhosts.allow_2)
    *   [3.2 Демоны](#.D0.94.D0.B5.D0.BC.D0.BE.D0.BD.D1.8B_2)
    *   [3.3 Монтирование удалённых директорий](#.D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.83.D0.B4.D0.B0.D0.BB.D1.91.D0.BD.D0.BD.D1.8B.D1.85_.D0.B4.D0.B8.D1.80.D0.B5.D0.BA.D1.82.D0.BE.D1.80.D0.B8.D0.B9)
    *   [3.4 Запись в /etc/fstab](#.D0.97.D0.B0.D0.BF.D0.B8.D1.81.D1.8C_.D0.B2_.2Fetc.2Ffstab)
    *   [3.5 soft или hard монтирование](#soft_.D0.B8.D0.BB.D0.B8_hard_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5)
        *   [3.5.1 Монтирование NFS и networkmanager](#.D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_NFS_.D0.B8_networkmanager)

## Установка

Для установки сервера и клиента достаточно установить пакет [nfs-utils](https://www.archlinux.org/packages/?name=nfs-utils).

Настоятельно рекомендуется на всех узлах (клиентских и серверных) использовать системы синхронизации времени [time sync daemon](/index.php/Time#Time_synchronization "Time"). Без точной синхронизации системного времени, в процессе функционирования NFS возможно возникновение дополнительных нежелательных задержек.

**Примечание:** Пакет [nfs-utils](https://www.archlinux.org/packages/?name=nfs-utils) для архитектуры ARM, начиная с версии 1.3.2-4 (а возможно и с более ранних версий) имеет некоторые отличия в функционировании от версий для архитектур x86_64 или i686\. Более детальную информацию о монтировании клиентских узлов можно найти на странице обсуждения dicsussion

## Конфигурация

### Сервер

Серверу NFS нужен список экспорта (общие каталоги), которые определены в `/etc/exports`. Шары NFS, определенные в `/etc/exports`, относятся к так называемому корню NFS. Хорошей практикой безопасности является определение корня NFS в дискретном дереве каталогов в корневой файловой системе сервера, который будет ограничивать пользователей этой точкой монтирования. Bind mounts are used to link the share mount point to the actual directory elsewhere on the filesystem.

Рассмотрим следующий пример, в котором:

1.  Корень NFS `/srv/nfs`.
2.  Экспорт `/srv/nfs/music` через крепление привязки к фактической цели `/mnt/music`.

```
# mkdir -p /srv/nfs/music /mnt/music
# mount --bind /mnt/music /srv/nfs/music

```

Чтобы монтирование выполнялось автоматически, добавьте строчки в `fstab`:

 `/etc/fstab` 
```
/mnt/music /srv/nfs/music  none   bind   0   0

```

**Примечание:** The permissions on the server filesystem is what NFS will honor so ensure that connecting users have the desired access.

**Примечание:** [ZFS](/index.php/ZFS "ZFS") filesystems require special handling of bindmounts, see [ZFS#Bind mount](/index.php/ZFS#Bind_mount "ZFS").

Добавьте каталоги для совместного использования и ограничьте их диапазоном адресов CIDR или имя хоста клиентских машин, которым будет разрешено устанавливать их в `/etc/exports`:

 `/etc/exports` 
```
/srv/nfs       192.168.1.0/24(rw,fsid=root,crossmnt)
/srv/nfs/music 192.168.1.0/24(rw) # чтение и запись для всех с диапазоном IP 192.168.1.*

```

Следует отметить, что изменение `/etc/exports` во время работы сервера потребует повторного экспорта, чтобы изменения вступили в силу выполните:

```
# exportfs -rav

```

Для получения дополнительной информации обо всех доступных опциях см. [exports(5)](http://jlk.fjfi.cvut.cz/arch/manpages/man/exports.5).

**Совет:** [ip2cidr](http://ip2cidr.com/) - это инструмент для преобразования диапазонов IP-адресов в корректно структурированную спецификацию CDIR.

**Примечание:** Если целевой экспорт является файловой системой tmpfs, требуется опция `fsid=1`.

#### Запуск сервера

[Start](/index.php/Start "Start") и [enable](/index.php/Enable "Enable") `nfs-server.service`.

#### Разное

##### Дополнительная конфигурация

Расширенные параметры конфигурации могут быть установлены в `/etc/nfs.conf`. Пользователям, настраивающим простую конфигурацию, может не понадобиться редактировать этот файл.

##### Ограничение NFS для интерфейсов/IP

По умолчанию запуск `nfs-server.service` будет прослушивать подключения на всех сетевых интерфейсах, независимо от `/etc/exports`. Это можно изменить, указав, какие IP-адреса и / или имена хостов должны прослушиваться.

 `/etc/nfs.conf` 
```
[nfsd]
host=192.168.1.123
# Кроме того, вы можете использовать имя хоста.
# host=myhostname
```

Изменения будут применены при повторном запуске службы.

```
# systemctl restart nfs-server.service

```

##### Убедиться что NFSv4 idmapping полностью включена

Несмотря на то, что idmapd может работать, он может быть не полностью включен. Убедитесь, что `/sys/module/nfsd/parameters/nfs4_disable_idmapping` возвращает `N` когда не запушен:

Установите в качестве [module option](/index.php/Kernel_modules#Setting_module_options "Kernel modules"), чтобы сделать изменение постоянными, пример:

 `/etc/modprobe.d/nfsd.conf` 
```
options nfsd nfs4_disable_idmapping=0

```

##### Статические порты для NFSv3

Пользователям, нуждающимся в поддержке клиентов NFSv3, может потребоваться использование статических портов. По умолчанию для операций NFSv3 `rpc.statd` и `lockd` используются случайные эфемерные порты; чтобы разрешить операции NFSv3 через статические порты брандмауэра. Измените `/etc/sysconfig/nfs`, чтобы установить `STATDARGS`:

 `/etc/sysconfig/nfs`  `STATDARGS="-p 32765 -o 32766 -T 32803"` 

Для нормальной работы `rpc.mountd` должен обращаться к `/etc/services` и привязываться к одному и тому же статическому порту 20048; однако, если для определения `/etc/sysconfig/nfs` должно быть определено значение `RPCMOUNTDARGS`:

 `/etc/sysconfig/nfs`  `RPCMOUNTDARGS="-p 20048"` 

После внесения этих изменений необходимо перезапустить несколько служб; первый записывает параметры конфигурации в `/run/sysconfig/nfs-utils` (см. `/usr/lib/systemd/scripts/nfs-utils_env.sh`), второй перезапускает `rpc.statd` с новыми портами, последний перезагружает `lockd` (модуль ядра) с новыми портами.[Перезапустите](/index.php/Restart "Restart") эти службы: `nfs-config`, `rpcbind`, `rpc-statd` и `nfs-server`.

После перезапуска на сервере для проверки статических портов используйте `rpcinfo -p`. Использование `rpcinfo -p <server IP>` от клиента должно выявлять те же самые статические порты.

##### Совместимость NFSv2

Для пользователей которые используют клиенты NFSv2 (например, U-Boot), нужно установить `RPCNFSDARGS="-V 2"` в `/etc/sysconfig/nfs`.

##### Конфигурация брандмауэра

Чтобы разрешить доступ через брандмауэр, необходимо использовать tcp и udp-порты 111, 2049 и 20048 при использовании конфигурации по умолчанию; используйте `rpcinfo -p`, чтобы проверить точные порты, используемые на сервере. Чтобы настроить это для [iptables](/index.php/Iptables "Iptables"), выполните следующие команды:

```
# iptables -A INPUT -p tcp -m tcp --dport 111 -j ACCEPT
# iptables -A INPUT -p tcp -m tcp --dport 2049 -j ACCEPT
# iptables -A INPUT -p tcp -m tcp --dport 20048 -j ACCEPT
# iptables -A INPUT -p udp -m udp --dport 111 -j ACCEPT
# iptables -A INPUT -p udp -m udp --dport 2049 -j ACCEPT
# iptables -A INPUT -p udp -m udp --dport 20048 -j ACCEPT

```

Чтобы загрузить эту конфигурацию при каждом запуске системы, отредактируйте `/etc/iptables/iptables.rules`:

 `/etc/iptables/iptables.rules` 
```
-A INPUT -p tcp -m tcp --dport 111 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 2049 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 20048 -j ACCEPT
-A INPUT -p udp -m udp --dport 111 -j ACCEPT
-A INPUT -p udp -m udp --dport 2049 -j ACCEPT
-A INPUT -p udp -m udp --dport 20048 -j ACCEPT

```

Предыдущие команды можно сохранить, выполнив следующие действия:

```
# iptables-save > /etc/iptables/iptables.rules

```

**Note:** Эта команда будет «отменять» текущую действующую конфигурацию запуска iptables на текущую выбранную

Если вы используете NFSv3 и перечисленные выше статические порты для `rpc.statd` и `lockd`, их также необходимо добавить в конфигурацию:

 `/etc/iptables/iptables.rules` 
```
-A INPUT -p tcp -m tcp --dport 32765 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 32803 -j ACCEPT
-A INPUT -p udp -m udp --dport 32765 -j ACCEPT
-A INPUT -p udp -m udp --dport 32803 -j ACCEPT

```

При использовании только для V4 необходимо открыть только порт tcp 2049\. Поэтому нужна только одна строка.

 `/etc/iptables/iptables.rules` 
```
-A INPUT -p tcp -m tcp --dport 2049 -j ACCEPT

```

Чтобы применить изменения, [Restart](/index.php/Restart "Restart") `iptables.service`.

### Клиент

Пользователи, намеревающиеся использовать NFS4 с [Kerberos](/index.php/Kerberos "Kerberos"), также должны [start](/index.php/Start "Start") и [enable](/index.php/Enable "Enable") `nfs-client.target`, который запускает `rpc-gssd.service`. Однако из-за ошибки [FS#50663](https://bugs.archlinux.org/task/50663) в glibc `rpc-gssd.service` в настоящее время не запускается. Добавление флага "-f" (foreground) в службе является обходным путем:

 `# systemctl edit rpc-gssd.service` 
```
[Unit]
Requires=network-online.target
After=network-online.target

[Service]
Type=simple
ExecStart=
ExecStart=/usr/sbin/rpc.gssd -f
```

#### Ручная установка

Для NFSv3 используйте эту команду для отображения экспортированных файловых систем сервера:

```
# mount server:/ /mountpoint/on/client

```

Затем отключите сервер NFS для экспорта сервера:

```
# mount -t nfs -o vers=4 servername:/music /mountpoint/on/client

```

Если монтирование не выполняется, попробуйте включить root экспорта сервера (требуется для Debian/RHEL/SLES, для некоторых дистрибутивов требуется `-t nfs4` вместо `-t nfs`):

```
# mount -t nfs -o vers=4 servername:/srv/nfs/music /mountpoint/on/client

```

**Примечание:** Имя сервера должно быть допустимым именем хоста (а не только IP-адресом). В противном случае установка удаленного ресурса будет зависать.

#### Монтирование с использованием /etc/fstab

Использование [fstab](/index.php/Fstab "Fstab") полезно для сервера, который всегда включен и общие ресурсы NFS доступны всякий раз, когда клиент загружается. Измените файл `/etc/fstab` и добавьте соответствующую строку, отражающую настройку. Опять же, root экспорта NFS сервера опущен.

 `/etc/fstab` 
```
servername:/music   /mountpoint/on/client   nfs   rsize=8192,wsize=8192,timeo=14,_netdev	0 0

```

**Примечание:** Консультируйтесь [nfs(5)](http://jlk.fjfi.cvut.cz/arch/manpages/man/nfs.5) и [mount(8)](http://jlk.fjfi.cvut.cz/arch/manpages/man/mount.8) для получения дополнительных параметров монтирования.

Некоторые дополнительные варианты монтирования, которые необходимо учитывать, включают:

	rsize и wsize

	значение `rsize` - это количество байтов, используемых при чтении с сервера. Значение `wsize` - это количество байтов, используемых при записи на сервер. Значение по умолчанию для обоих равно 1024, но использование более высоких значений, таких как 8192, может повысить пропускную способность. Это не универсально. Рекомендуется выполнить проверку после внесения этого изменения, см. [#Performance tuning](#Performance_tuning).

	timeo

	значение `timeo` - это время, в десятые доли секунды, для ожидания перед повторной отправкой передачи после таймаута RPC. После первого таймаута значение тайм-аута удваивается для каждой повторной попытки в течение максимум 60 секунд или до тех пор, пока не произойдет большой тайм-аут. Если вы подключаетесь к медленному серверу или по сети с занятостью, более высокая производительность может быть достигнута за счет увеличения этого значения таймаута.

	_netdev

	Опция `_netdev` сообщает системе ждать, пока сеть не встанет, прежде чем пытаться установить общий ресурс. systemd предполагает это для NFS, но в любом случае это хорошая практика использовать его для всех типов сетевых файловых систем

**Примечание:** Установка шестого поля (`fs_passno`) на ненулевое значение может привести к неожиданному поведению, например. зависанию, когда systemd automount ждет проверки, которая никогда не произойдет.

#### Монтирование с использованием /etc/fstab с systemd

Другим методом является использование службы systemd `automount`. Это лучший вариант, чем `_netdev`, поскольку он быстро подключает сетевое устройство, когда соединение сломано и восстановлено. Кроме того, он решает проблему с помощью autofs, см. Пример ниже:

 `/etc/fstab`  `servername:/home   */mountpoint/on/client*  nfs  noauto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0` 

Возможно, придется перезагрузить клиент, чтобы система systemd знала об изменениях в fstab. Кроме того, попробуйте [reloading](/index.php/Systemd#Using_units "Systemd") systemd и перезапустите `*mountpoint-on-client*.automount`, чтобы перезагрузить конфигурацию `/etc/fstab`.

**Tip:**

*   Параметр `noauto` не будет монтировать общий ресурс NFS до его обращения: используйте `auto`, чтобы он был доступен немедленно.
    Если у вас возникли проблемы с сбоем подключения из-за недоступности / доступности сети, [enable](/index.php/Enable "Enable") `NetworkManager-wait-online.service`. Это гарантирует, что `network.target` имеет все доступные ссылки до того, как они будут активны.
*   Параметр mount `users` позволит пользователям монтировать, но имейте в виду, что он подразумевает дополнительные опции, например, `noexec`.
*   Параметр `x-systemd.idle-timeout=1min` автоматически отключит общий ресурс NFS через 1 минуту неиспользования. Хорошо для ноутбуков, которые могут внезапно отключиться от сети.
*   Если выключение/перезагрузка выполняется слишком долго из-за NFS, [enable](/index.php/Enable "Enable") `NetworkManager-wait-online.service`, чтобы гарантировать, что NetworkManager не будет удален до того, как тома NFS будут размонтированы. Вы также можете попытаться добавить параметр `x-systemd.requires=network.target`, если выключение занимает слишком много времени.

### Файлы

#### /etc/exports

Этот файл (/etc/exports) содержит различные разделяемые каталоги и права на них на сервере.
Несколько примеров:

```
/files *(ro,sync) # Только чтение для всех access to anyone
/files 192.168.0.2(rw,sync) # Чтение и запись для клиента с IP 192.168.0.2
/files 192.168.1.1/24(rw,sync) # Чтение и запись для всех клиентов с 192.168.1.1 по 192.168.1.255

```

Чтобы изменения вступили в силу без перезапуска демона, выполните команду:

```
# exportfs -arv

```

Если вы хотите сделать ваш разделённый NFS каталог открытым и с правом записи, вы можете использовать опцию all_squash в комбинации с опциями anonuid и anongid.

Например, чтобы установить права для пользователя 'nobody' в группе 'nobody', вы можете сделать следующее:

```
; Доступ на чтение и запись для клиента на 192.168.0.100, с доступом rw для пользователя 99 с gid 99
/files 192.168.0.100(rw,sync,all_squash,anonuid=99,anongid=99))

```

Это также означает, что если вы хотите разрешить доступ к указанной директории, nobody.nobody должен быть владельцем разделённой директории:

```
# chown -R nobody.nobody /files

```

Подробнее - читайте man exports.

#### /etc/hosts.allow

Чтобы разрешить доступ по сети к nfs серверу для IP 192.168.0.101, вам надо добавить следующие строчки в /etc/hosts.allow:

```
nfsd: 192.168.0.101/255.255.255.255
rpcbind: 192.168.0.101/255.255.255.255
mountd: 192.168.0.101/255.255.255.255

```

Что разрешить доступ всем из подсети 192.168.0.*, необходмио добавить:

```
nfsd: 192.168.0.0/255.255.255.0
rpcbind: 192.168.0.0/255.255.255.0
mountd: 192.168.0.0/255.255.255.0

```

Чтобы все машины могли иметь доступ, напишите в файл /etc/hosts.allow следующие строчки:

```
nfsd: ALL
rpcbind: ALL
mountd:ALL

```

Подробнее про настройку файла /etc/hosts.allow, смотрите, например, [http://www.die.net/doc/linux/man/man5/hosts.allow.5.html](http://www.die.net/doc/linux/man/man5/hosts.allow.5.html)

### Демоны

Для запуска nfs сервера, вам требуется запустить несколько демонов:

```
# /etc/rc.d/rpcbind start (или: /etc/rc.d/portmap start)
# /etc/rc.d/nfs-common start (или: /etc/rc.d/nfslock start)
# /etc/rc.d/nfs-server start (или: /etc/rc.d/nfsd start)

```

Вы можете добавить эти демоны в список в файл /etc/rc.conf, чтобы они запускались при загрузке системы. Обязательно проследите, чтобы демоны запускались именно в этом порядке.

## Настройка клиента

#### /etc/hosts.allow

Вам необходимо разрешить rpcbind для IP сервреа:

```
 rpcbind: 192.168.0.100/255.255.255.255

```

#### Демоны

Запустите rpcbind и nfslock демоны:

```
/etc/rc.d/rpcbind start (or: /etc/rc.d/portmap start)
/etc/rc.d/nfs-common start (or: /etc/rc.d/nfslock start)

```

Заметьте, что демоны должны запускать именно в этом порядке, или только nfs-common, тогда rpcbind будет запущен автоматически как зависимость.

Для автоматического запуска демонов при загрузке системы добавьте их в файл /etc/rc.conf.

### Монтирование удалённых директорий

Монтирование удалённых каталогов происходит так же, как и локальных (предположим, что точка монтирование /mnt/home существует):

```
# mount 192.168.0.1:/home /mnt/home

```

Отмонтировать можно так же, как и локальный каталог:

```
# umount /mnt/home

```

### Запись в /etc/fstab

Файловые системы NFS могут быть добавлены в файл /etc/fstab так же, как и локальные, но существует некоторые отличия: тип файловой системы должен быть nfs и значения dump и fsck order (последние две записи в строчке) должны быть равны 0\. Итак, вот пример записи в файле /etc/fstab:

```
# device           mountpoint     fs-type     options      dump fsckorder
...
192.168.0.1:/home    /mnt          nfs          rw          0       0
...

```

### soft или hard монтирование

nfs клиент может обрабатывать сбои сервера в работе. Есть две опции монтирования: hard и soft.

soft:

Если запрос на получение файла не выполнен, NFS клиент сообщит об ошибке процессу, который пытается получить доступ к файлу. Некоторые программы умеют это обрабатывать, большая же часть - нет. Разработчики nfs не рекомендуют использовать эту опцию; это прямой путь к повреждённым данным и потере информации.

hard:

Программа, осуществляющая доступ к файлу повиснет при смерти сервера. Процесс не может быть прерван или убит (только "sure kill"), пока вы не укажете опцию intr. Когда NFS сервер вернётся к работе, программа продолжит работу с того места, где остановилась. Разработчики NFS рекомендуют использование опций hard,intr со всеми монтируемые NFS файловые системы.

Смотрите man mount для подробной информации об опциях монтирования.

#### Монтирование NFS и networkmanager

Автоматическое монтирование nfs при появлении сети и автоматическое её отмонтирование при её отсутствии. Для этого создадим файл /etc/NetworkManager/dispatcher.d/01ifupdown, в него запишем:

```
#!/bin/bash
      if [ `nm-tool|grep State|cut -f2 -d' '` == "connected" ]; then
              mount -t nfs %server%:%server_dir% %local_dir%
      else
              umount %local_dir%
      fi

```

Где %server% - ip адрес сервера nfs, %server_dir% - директория на сервере, которую требуется подмонтировать и %local_dir% - директория куда оно будет монтироваться.