Ссылки по теме

*   [Файловые системы](/index.php/%D0%A4%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B "Файловые системы")

**Состояние перевода:** На этой странице представлен перевод статьи [XFS](/index.php/XFS "XFS"). Дата последней синхронизации: 24 июля 2017\. Вы можете [помочь](/index.php/ArchWiki_Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ArchWiki Translation Team (Русский)") синхронизировать перевод, если в английской версии произошли [изменения](https://wiki.archlinux.org/index.php?title=XFS&diff=0&oldid=482825).

XFS — высокопроизводительная журналируемая файловая система, созданная Silicon Graphics, Inc. XFS особенно хорошо справляется с параллельным вводом-выводом благодаря структуре на основе заголовков для групп (allocation groups), что обеспечивает исключительную масштабируемость потоков ввода-вывода, пропускной способности файловой системы, размера файлов и файловой системы при работе с несколькими устройствами хранения.

<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none">

## Contents

<label class="toctogglelabel" for="toctogglecheckbox"></label>

*   [1 Установка](#Установка)
*   [2 Повреждение данных](#Повреждение_данных)
    *   [2.1 Восстановление файловой системы XFS](#Восстановление_файловой_системы_XFS)
    *   [2.2 Проверка метаданных "на лету" (scrub)](#Проверка_метаданных_"на_лету"_(scrub))
*   [3 Целостность](#Целостность)
*   [4 Производительность](#Производительность)
    *   [4.1 Размер и ширина полосы (stripe)](#Размер_и_ширина_полосы_(stripe))
    *   [4.2 Время доступа](#Время_доступа)
    *   [4.3 Дефрагментация](#Дефрагментация)
        *   [4.3.1 Проверка уровня фрагментации](#Проверка_уровня_фрагментации)
        *   [4.3.2 Выполнение дефрагментации](#Выполнение_дефрагментации)
    *   [4.4 Свободный btree инод](#Свободный_btree_инод)
*   [5 Решение проблем](#Решение_проблем)
    *   [5.1 Квота корневой файловой системы](#Квота_корневой_файловой_системы)
*   [6 Смотрите также](#Смотрите_также)

## Установка

Инструменты для управления разделами XFS находятся в пакете [xfsprogs](https://www.archlinux.org/packages/?name=xfsprogs), который включён в базовую установку по умолчанию.

## Повреждение данных

В случае повреждения данных по какой-либо причине придётся восстанавливать файловую систему вручную.

### Восстановление файловой системы XFS

Сначала размонтируйте файловую систему XFS.

```
# umount /dev/sda3

```

После размонтирования запустите утилиту [xfs_repair(8)](https://jlk.fjfi.cvut.cz/arch/manpages/man/xfs_repair.8).

```
# xfs_repair -v /dev/sda3

```

### Проверка метаданных "на лету" (scrub)

**Важно:** Эта программа является ЭКСПЕРИМЕНТАЛЬНОЙ, соответственно, её поведение и интерфейс могут измениться в любое время, см. [xfs_scrub(8)](https://jlk.fjfi.cvut.cz/arch/manpages/man/xfs_scrub.8).

`xfs_scrub` запрашивает ядро очистить (scrub) все объекты метаданных в XFS.Записи метаданных сканируются на очевидно ошибочные значения, после чего перекрёстно ссылаются на остальные метаданные. Это делается для того, чтобы иметь достаточно уверенности в целостности всей файловой системы, анализируя отдельные записи метаданных на фоне остальных метаданных в файловой системе. Повреждённые метаданные можно восстановить из других метаданных при наличии неповреждённых избыточных структур данных.

[Включите](/index.php/%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D0%B5 "Включите") и [запустите](/index.php/%D0%97%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D0%B5 "Запустите") `xfs_scrub_all.timer` для периодической проверки метаданных всех файловых систем XFS "на лету".

**Примечание:** Для удобства, можно [отредактировать](/index.php/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Редактирование_предоставленных_пакетами_файлов_юнитов "Systemd (Русский)") `xfs_scrub_all.timer`: таймер выполняется каждое воскресенье в 3:10 и [сразу же запускается](/index.php/Systemd/Timers#Realtime_timer "Systemd/Timers"), если последний запуск был пропущен (например, так как система была выключена).

## Целостность

В [xfsprogs](https://www.archlinux.org/packages/?name=xfsprogs) 3.2.0 появился новый дисковый (on-disk) формат (v5), включающий в себя схему контрольных сумм метаданных — [Self-Describing Metadata](https://www.kernel.org/doc/Documentation/filesystems/xfs-self-describing-metadata.txt). Она основывается на CRC32 и обеспечивает, к примеру, дополнительную защиту от повреждения метаданных при непредвиденном отключении электропитания. Контрольная сумма включена по умолчанию начиная с [xfsprogs](https://www.archlinux.org/packages/?name=xfsprogs) 3.2.3\. Если требуется монтируемый для чтения-записи раздел XFS на более старом ядре, данная функция легко отключается с помощью параметра `-m crc=0` при вызове [mkfs.xfs(8)](https://jlk.fjfi.cvut.cz/arch/manpages/man/mkfs.xfs.8).

```
# mkfs.xfs -m crc=0 /dev/*необходимый_раздел*

```

Дисковый (on-disk) формат XFS v5 считается стабильным для промышленной эксплуатации начиная с ядра Linux 3.15.

**Примечание:** В отличие от [Btrfs (Русский)](/index.php/Btrfs_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Btrfs (Русский)") и [ZFS (Русский)](/index.php/ZFS_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ZFS (Русский)"), контрольная сумма CRC32 применяется только к метаданным, а не к фактическим данным.

## Производительность

Просто создайте файловую систему XFS, чтобы достичь оптимальной скорости:

```
# mkfs.xfs /dev/*необходимый_раздел*

```

В XFS [все улучшения включены по умолчанию](http://xfs.org/index.php/XFS_FAQ#Q:_I_want_to_tune_my_XFS_filesystems_for_.3Csomething.3E).

Смотрите также [xfs(5)](https://jlk.fjfi.cvut.cz/arch/manpages/man/xfs.5) для получения информации о доступных параметрах монтирования.

**Совет:** При использовании XFS на устройствах с [RAID (Русский)](/index.php/RAID_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "RAID (Русский)"), улучшить производительность можно с помощью `largeio`, `swalloc`, увеличенными значениями `logbsize`, `allocsize` и так далее. В следующих статьях предоставлена дополнительная информация об этих флагах:

*   [https://www.beegfs.io/wiki/StorageServerTuning](https://www.beegfs.io/wiki/StorageServerTuning)
*   [https://help.marklogic.com/Knowledgebase/Article/View/505/0/recommended-xfs-settings-for-marklogic-server](https://help.marklogic.com/Knowledgebase/Article/View/505/0/recommended-xfs-settings-for-marklogic-server)

### Размер и ширина полосы (stripe)

Если файловая система будет использоваться на чередующемся RAID-массиве, можно значительно повысить скорость, указав размер полосы (stripe) в команде [mkfs.xfs(8)](https://jlk.fjfi.cvut.cz/arch/manpages/man/mkfs.xfs.8).

Смотрите также [How to calculate the correct sunit,swidth values for optimal performance](http://xfs.org/index.php/XFS_FAQ#Q:_How_to_calculate_the_correct_sunit.2Cswidth_values_for_optimal_performance)

### Время доступа

В некоторых файловых системах можно повысить производительность, добавив параметр монтирования `noatime` в файле `/etc/fstab`. Для XFS стандартным поведением atime является `relatime`, которое почти не имеет накладных расходов по сравнению с noatime, но при этом сохраняет нормальные значения atime. Все файловые системы Linux теперь используют это в качестве значения по умолчанию (примерно с версии 2.6.30), но XFS использует relatime-поведение с 2006 года, поэтому нет никакой необходимости использовать noatime по соображениям производительности.

Кроме того, `noatime` подразумевает `nodiratime`, поэтому нет необходимости указывать **nodiratime** при уже заданном **noatime**.

### Дефрагментация

Хотя основанная на экстентах природа XFS и используемая стратегия отложенного размещения значительно повышают устойчивость файловой системы к проблемам фрагментации, XFS предоставляет утилиту *xfs_fsr* (сокращение от "реорганизатора файловой системы XFS") для дефрагменентации файлов на смонтированной и активной файловой системе XFS. Также полезно периодически проверять фрагментацию XFS.

[xfs_fsr(8)](https://jlk.fjfi.cvut.cz/arch/manpages/man/xfs_fsr.8) улучшает организацию смонтированных файловых систем. Алгоритм реорганизации работает с одним файлом за раз, сжимая или улучшая размещение экстентов файла (последовательных блоков данных файла).

#### Проверка уровня фрагментации

Проверить уровень фрагментации в данный момент можно следующей командой:

```
# xfs_db -c frag -r /dev/sda3

```

#### Выполнение дефрагментации

Используйте команду [xfs_fsr(8)](https://jlk.fjfi.cvut.cz/arch/manpages/man/xfs_fsr.8), чтобы начать дефрагментацию:

```
# xfs_fsr /dev/sda3

```

### Свободный btree инод

Начиная с Linux 3.16, XFS добавила btree, который отслеживает свободные иноды. Это эквивалентно существующему btree для распределения инодов, за исключением того, что свободный btree inode отслеживает фрагменты inode, по крайней мере, с одним свободным inode. Цель состоит в том, чтобы улучшить поиск свободных кластеров inode для распределения inode. Это повышает производительность на устаревших файловых системах, то есть на месяцы или годы, когда вы добавили и удалили миллионы файлов в / из файловой системы. Использование этой функции не влияет на общий уровень надежности файловой системы или возможности восстановления.

This feature relies on the new v5 on-disk format that has been considered stable for production workloads starting Linux Kernel 3.15\. It does not change existing on-disk structures, but adds a new one that must remain consistent with the inode allocation btree; for this reason older kernels will only be able to mount read-only filesystems with the free inode btree feature.

Функция включена по умолчанию при использовании xfsprogs 3.2.3 или новее. Если вам требуется доступная для записи файловая система для более старого ядра, ее можно отключить с помощью переключателя `finobt=0` при форматировании раздела XFS. Вам нужно `crc=0` вместе.

```
# mkfs.xfs -m crc=0,finobt=0 /dev/*target_partition*

```

or shortly (`finobt` depends `crc`)

```
# mkfs.xfs -m crc=0 /dev/*target_partition*

```

## Решение проблем

### Квота корневой файловой системы

Параметры монтирования XFS (`uquota`, `gquota`, `prjquota` и т.д.) Не выполняются во время повторного монтирования файловой системы. Чтобы включить квоту для корневой файловой системы, параметр монтирования должен быть передан initramfs как [kernel parameter](/index.php/Kernel_parameter "Kernel parameter") `rootflags=`. Впоследствии его не следует указывать среди параметров монтирования в `/etc/fstab` для корневой (`/`) файловой системы.

**Примечание:** Существуют некоторые различия в квоте XFS по сравнению со стандартным Linux [Disk quota](/index.php/Disk_quota "Disk quota"), эту статью [http://inai.de/linux/adm_quota](http://inai.de/linux/adm_quota) стоит прочитать.

## Смотрите также

*   [XFS FAQ](http://xfs.org/index.php/XFS_FAQ)
*   [Improving Metadata Performance By Reducing Journal Overhead](http://xfs.org/index.php/Improving_Metadata_Performance_By_Reducing_Journal_Overhead)
*   [XFS Wikipedia Entry](https://en.wikipedia.org/wiki/XFS "wikipedia:XFS")