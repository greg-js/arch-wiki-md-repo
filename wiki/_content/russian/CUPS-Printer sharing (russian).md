**Состояние перевода:** На этой странице представлен перевод статьи [CUPS/Printer sharing](/index.php/CUPS/Printer_sharing "CUPS/Printer sharing"). Дата последней синхронизации: 17 ноября 2017\. Вы можете [помочь](/index.php/ArchWiki_Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ArchWiki Translation Team (Русский)") синхронизировать перевод, если в английской версии произошли [изменения](https://wiki.archlinux.org/index.php?title=CUPS/Printer_sharing&diff=0&oldid=497002).

Ссылки по теме

*   [Samba (Русский)](/index.php/Samba_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Samba (Русский)")
*   [CUPS (Русский)](/index.php/CUPS_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "CUPS (Русский)")

Эта статья содержит инструкции по совместному использованию принтеров между системами, будь то между двумя системами GNU/Linux или между системой GNU/Linux и Microsoft Windows.

## Contents

*   [1 Внутри систем GNU/Linux](#.D0.92.D0.BD.D1.83.D1.82.D1.80.D0.B8_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC_GNU.2FLinux)
    *   [1.1 Использование веб-интерфейса](#.D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B2.D0.B5.D0.B1-.D0.B8.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81.D0.B0)
    *   [1.2 Ручная настройка](#.D0.A0.D1.83.D1.87.D0.BD.D0.B0.D1.8F_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0)
    *   [1.3 Включение обнаружения](#.D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BE.D0.B1.D0.BD.D0.B0.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F)
*   [2 Между GNU/Linux и Windows](#.D0.9C.D0.B5.D0.B6.D0.B4.D1.83_GNU.2FLinux_.D0.B8_Windows)
    *   [2.1 сервер Linux - клиент Windows](#.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80_Linux_-_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82_Windows)
        *   [2.1.1 Общий доступ с помощью IPP](#.D0.9E.D0.B1.D1.89.D0.B8.D0.B9_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_IPP)
        *   [2.1.2 Общий доступ с помощью Samba](#.D0.9E.D0.B1.D1.89.D0.B8.D0.B9_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_Samba)
    *   [2.2 Windows server - Linux client](#Windows_server_-_Linux_client)
        *   [2.2.1 Общий доступ с помощью LPD](#.D0.9E.D0.B1.D1.89.D0.B8.D0.B9_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_LPD)
        *   [2.2.2 Общий доступ с помощью IPP](#.D0.9E.D0.B1.D1.89.D0.B8.D0.B9_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_IPP_2)
        *   [2.2.3 Общий доступ с помощью Samba](#.D0.9E.D0.B1.D1.89.D0.B8.D0.B9_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_Samba_2)
            *   [2.2.3.1 Использование веб-интерфейса](#.D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B2.D0.B5.D0.B1-.D0.B8.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81.D0.B0_2)
            *   [2.2.3.2 Ручная настройка](#.D0.A0.D1.83.D1.87.D0.BD.D0.B0.D1.8F_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_2)
    *   [2.3 Устранение неполадок](#.D0.A3.D1.81.D1.82.D1.80.D0.B0.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BD.D0.B5.D0.BF.D0.BE.D0.BB.D0.B0.D0.B4.D0.BE.D0.BA)
*   [3 Другие операционные системы](#.D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BE.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.BE.D0.BD.D0.BD.D1.8B.D0.B5_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B)

## Внутри систем GNU/Linux

Сервер можно настраивать с помощью веб-интерфейса или путем ручного редактирования файла `/etc/cups/cupsd.conf`. Смотрите раздел [CUPS (Русский)#Сеть](/index.php/CUPS_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#.D0.A1.D0.B5.D1.82.D1.8C "CUPS (Русский)") для настройки клиента.

### Использование веб-интерфейса

Для доступа к странице администрирования CUPS, откройте в браузере адрес: [http://localhost:631](http://localhost:631).

В верхней части находится вкладка *Администрирование* - кликните по ней, нажмите на кнопку добавления принтера, при этом будут автоматически определены подключенные принтеры. Если этого не произойдет, отключите принтер и подключите его снова.

После создания принтера зайдите в раздел *Сервер* и установите флажок напротив "Разрешить совместный доступ к принтерам, подключенным к этой системе". После клика по *Сохранить*, сервер будет перезапущен автоматически.

Для более детальной настройки вы можете отредактировать файл `/etc/cups/cupsd.conf`, нажав кнопку "Редактировать конфигурационный файл". Для получения дополнительной информации смотрите [#Ручная настройка](#.D0.A0.D1.83.D1.87.D0.BD.D0.B0.D1.8F_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0).

### Ручная настройка

На сервере (тот, который управляет и подсоединён к принтеру) разрешите доступ к серверу, изменив строчки с тэгом Location. Например:

 `/etc/cups/cupsd.conf` 
```
<Location />
    Order allow,deny
    Allow localhost
    Allow 192.168.0.*
</Location>
...

```

Также убедитесь, что серверу для адресации доступен IP-адрес клиента:

 `/etc/cups/cupsd.conf` 
```
...
Listen <hostname>:631
...

```

Есть другие возможности для настройки, включая автоматические способы, которые детально описаны в [Использование сетевых принтеров](https://www.cups.org/doc/network.html) и [cupsd.conf(5)](https://jlk.fjfi.cvut.cz/arch/manpages/man/cupsd.conf.5).

После внесения каких-либо изменений [перезапустите](/index.php/%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D0%B5 "Перезапустите") службу `org.cups.cupsd`.

Если CUPS запускается с помощью активации сокета, создайте [drop-in snippet](/index.php/Drop-in_snippet "Drop-in snippet") для `org.cups.cupsd.socket`, чтобы активация сокета работала и с удаленными подключениями:

 `/etc/systemd/system/org.cups.cupsd.socket.d/override.conf` 
```
[Socket]
ListenStream=631

```

### Включение обнаружения

Чтобы включить отображение (обнаружение) общего принтера, необходимо установить [Avahi](/index.php/Avahi "Avahi") и запустить его на сервере. Если вам не нужно обнаружения принтера, тогда Avahi не требуется ни на сервере, ни на клиенте.

Чтобы включить отображение, выберите *Показывать общие принтеры, подключенные к этой системе* в веб-интерфейсе, или вручную включите Browsing и введите BrowseAddress:

 `/etc/cups/cupsd.conf` 
```
...
Browsing On
BrowseAddress 192.168.0.*:631
...

```

затем [перезапустите](/index.php/%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D0%B5 "Перезапустите") службу `org.cups.cupsd`.

Обратите внимание, что "обнаружение" на сервере - другая вещь по сравнению с "обнаружением" на удаленном сетевом хосте. На сервере печати `cupsd` предоставляет поддержку протокола DNS-SD, который транслируется `avahi-daemon`. Служба `cups-browsed` не нужна на сервере печати за исключением, если будет транслироваться старый протокол CUPS'а, или если сервер печати также будет "обнаруживать" другие сетевые принтеры. На удаленном сетевом хосте служба `cups-browsed` *требуется* для "обнаружения" сетевой трансляции служб печати, а также запущенная служба `cups-browsed` будет автоматически запускать `cupsd`.

Служба `org.cups.cupsd.service` запускается автоматически при подключении USB-принтера, но это может быть не так для других типов подключений. Если `cupsd` не запущен, тогда `avahi-daemon` не транслирует службу печати, поэтому в этом случае service-файл юнита systemd должен быть изменен при запуске во время загрузки, а затем служба снова должна быть "включена/установлена" с новой зависимостью. Чтобы сделать это, [отредактируйте](/index.php/%D0%9E%D1%82%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D1%83%D0%B9%D1%82%D0%B5 "Отредактируйте") раздел файла службы `[Install]`, добавив зависимость `WantedBy=default.target`, а затем [включите](/index.php/%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D0%B5 "Включите") и [запустите](/index.php/%D0%97%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D0%B5 "Запустите") службу `org.cups.cupsd.service`.

## Между GNU/Linux и Windows

### сервер Linux - клиент Windows

#### Общий доступ с помощью IPP

В качестве **предпочтительного метода**, при подключении клиента Windows к серверу печати Linux, используется [IPP](https://en.wikipedia.org/wiki/ru:Internet_Printing_Protocol "w:ru:Internet Printing Protocol"), поскольку настройка у него проще, чем у Samba. Это стандартный, основанный на HTTP, протокол принтера, который позволяет использовать преимущества переадресации портов, туннелирования и т.д. ОС Windows имеет встроенную поддержку IPP только начиная с Windows 2000.

**Примечание:** Возможно, вам придется добавить Internet Printing Client в Windows (*Панель управления > Программы > Включение или отключение компонентов Windows > Службы печати и документов*)

Сначала, настройте сервер как описано в разделе [#Внутри систем GNU/Linux](#.D0.92.D0.BD.D1.83.D1.82.D1.80.D0.B8_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC_GNU.2FLinux).

На компьютере с Windows, перейдите в *Панель управления > Просмотр устройств и принтеров* и выберите в контекстном меню 'Добавить принтер'. Если у вас Windows 10, нажмите кнопку "Принтер, который я хочу, не указан". Далее, выберите 'Выбрать общий принтер по имени' и тип расположения принтера:

```
http://*hostname*:631/printers/*printer_name*

```

(Где *hostname* - это имя хоста или IP-адрес сервера GNU/Linux, а *printer_name* - это имя подключенного принтера. Вы также можете использовать полное доменное имя сервера, если оно есть, но вам может потребоваться установить `ServerAlias my_fully_qualified_domain_name` в `/etc/cups/cupsd.conf`, чтобы это заработало).

**Примечание:**

*   Диалоговое окно 'Добавить принтер' в Windows предлагает формат `http://computername/printers/printername/.printer`, который Windows не примет. Вместо этого используйте синтаксис, предложенный выше.
*   Если вы используете прокси, тщательно проверяйте все использованные прокси **исключения**. Неправильная настройка здесь может привести к невозможности добавления принтера до следующей перезагрузки, даже если вы отключите прокси-сервер после этого (по крайней мере, в Windows 7).

После этого на компьютере с Windows установите родные драйвера принтера. Если на сервере CUPS используются собственные драйвера на принтер вместо `raw` очереди, то для клиента Windows можно выбрать драйвер принтера generic postscript (например 'HP Color LaserJet 8500 PS' или 'Xerox DocuTech 135 PS2').

#### Общий доступ с помощью Samba

Если версия ОС Windows ниже Windows 2000, или при использовании IPP возникают проблемы, можно настроить общий доступ с помощью Samba. Учитывайте, что при использовании Samba будет задействовано дополнительное программное обеспечение. Поэтому данный способ **сложнее в настройке**, также могут возникнуть **дополнительные проблемы**, связанные, в основном, с аутентификацией.

Для настройки Samba на сервере Linux, отредактируйте файл `/etc/samba/smb.conf`, это даст возможность предоставить общий доступ к принтерам. Файл `smb.conf` может содержать примерно следующее:

 `/etc/samba/smb.conf` 
```
[global]
    workgroup=Heroes
    server string=Arch Linux Print Server
    security=user

[printers]
    comment=All Printers
    path=/var/spool/samba
    browseable=yes
    # to allow user 'guest account' to print.
    guest ok=no
    writable=no
    printable=yes
    create mode=0700
    write list=@adm root yourusername
```

Этого должно быть достаточно для организации совместного доступа, но все-таки рекомендуется добавить для принтера отдельную запись:

 `/etc/samba/smb.conf` 
```
[ML1250]
    comment=Samsung ML-1250 Laser Printer
    printer=ml1250
    path=/var/spool/samba
    printing=cups
    printable=yes
    printer admin=@admin root yourusername
    user client driver=yes
    # to allow user 'guest account' to print.
    guest ok=no
    writable=no
    write list=@adm root yourusername
    valid users=@adm root yourusername
```

Учтите, что при таких настройках, должна существовать учетная запись с правами доступа к принтеру. Для публичного принтера установите *guest ok* в *yes*, и удалите строку *valid users*. Для добавления учетных записей, создайте действующую учетную запись GNU/Linux, а затем установите на Samba-сервере пароль. Например:

```
# useradd yourusername
# smbpasswd -a yourusername

```

Затем перезапустите демон Samba:

```
# /etc/rc.d/samba restart

```

Естественно, имеется множество дополнительных настроек сервера печати Samba, поэтому, для получения дополнительной информации, следует обратиться к справочной документации Samba и CUPS. Образцы и примеры можно посмотреть в файле `smb.conf.example`.

### Windows server - Linux client

#### Общий доступ с помощью LPD

Поскольку в Windows 7 имеется интегрированный LPD-сервер, то, возможно, будет намного проще использовать именно его, поскольку не придется для клиента устанавливать *Samba*, а на сервере - можно будет обойтись без сложных настроек.

Затем, принтер можно будет добавить в CUPS просто выбрав протокол LPD. Адресс принтера будет выглядеть следующим образом:

```
# lpd://windowspc/printersharename

```

Перед добавлением вам, скорее всего, понадобиться установить для своей модели принтера соответствующий драйвер. Драйвера Generic PostScript или RAW тоже должны работать.

#### Общий доступ с помощью IPP

Как и в предыдущем случае, для организации общего доступа к принтерам протокол IPP является **предпочтительным**. Но, так как потребуется приложить немного больше усилий в сравнении с использованием Samba, метод создания IPP-Сервера в Windows может оказаться **более сложным**. Обычно выбирают программное обеспечение от Microsoft's Internet Information Services (IIS).

**Примечание:** Этот раздел является неполным. Более подробное описание по настройке ISS для Windows XP и Windows 2000, можно найти на немецком (к сожалению) [[1]](http://www.heise.de/netze/artikel/Ueberall-drucken-221652.html)

#### Общий доступ с помощью Samba

**Гораздо проще** использовать стандартные возможности Windows по предоставлению общего доступа к принтерам с помощью Samba. Ручная настройка практически не требуется и все можно выполнить через CUPS Backend. Однако, как было замечено выше, в Windows могут возникнуть проблемы с аутентификацией и ограничением доступа.

На стороне сервера необходимо разрешить общий доступ к принтеру и убедится, что клиентские машины имеют к этому принтеру доступ.

В следующем разделе будут описаны настройки клиента с обоими (cupsd и smbd) запущенными демонами.

##### Использование веб-интерфейса

Backend Samba CUPS должен быть запущен по умолчанию, но если этого не происходит - введите следующую команду и перезапустите CUPS.

```
# ln -s $(which smbspool) /usr/lib/cups/backend/smb

```

Затем, просто зайдите в веб-интерфейс CUPS и добавьте новый принтер. В качестве устройства выберите "Windows Printer via SAMBA".

Для местоположения устройства, выберите:

```
smb://username:password@hostname/имя_принтера

```

Или, если пароля нет:

```
smb://username@hostname/имя_принтера

```

Убедитесь, что пользователь действительно имеет доступ к принтеру на компьютере Windows, и выберите соответствующие драйверы. Если компьютер находится в домене, убедитесь, что в имени пользователя присутствует домен:

```
smb://username:password@domain/hostname/имя_принтера

```

Если в сети доступно много принтеров, то можно выбрать предпочитаемый. Для этого войдите в веб-интерфейс, перейдите на вкладку Принтеры, выберите нужный принтер и, в выпадающем списке, установите 'Set as default' ('Использовать по умолчанию').

##### Ручная настройка

При ручной настройке: остановите демон CUPS и добавьте свой принтер в `/etc/cups/printers.conf`, который, к примеру, может выглядеть так:

 `/etc/cups/printers.conf` 
```
<DefaultPrinter MyPrinter>
AuthInfoRequired username,password
Info My printer via SAMBA
Location In my Office
MakeModel Samsung ML-1250 - CUPS+Gutenprint v5.2.7        # <= для получения списка доступных моделей запустить 'lpinfo -m'
DeviceURI smb://username:password@hostname/printer_name   # <= URI сервера, выбирать согласно описания в предыдущем разделе
State Idle
Type 4
Accepting Yes
Shared No
JobSheets none none
QuotaPeriod 0
PageLimit 0
KLimit 0
AllowUser yourusername                                    # <= не забудьте изменить это
OpPolicy default
ErrorPolicy stop-printer
</Printer>
```

Перезапустите демон CUPS и распечатайте тестовую страницу.

Для установки предпочтительного принтера используйте следующую команду:

```
# lpoptions -d имя_принтера_используемого_по_умолчанию

```

### Устранение неполадок

Если возникают какие-либо проблемы, первое, что нужно сделать - это включить отладочную информацию, для этого в `/etc/cups/cupsd.conf` установите:

 `LogLevel debug` 

Затем перезапустите демон CUPS и в файле `/var/log/cups/error_log` проверьте сообщения об ошибках. Удобнее просматривать так:

```
# tail -f /var/log/cups/error_log

```

будут выведены сообщения о появившихся ошибках.

**Примечание:** Для изучения файла ошибок также можно воспользоваться веб-интерфейсом

## Другие операционные системы

Более подробную информацию о взаимодействии CUPS с другими системами печати можно найти в руководстве CUPS, например, на [http://localhost:631/sam.html#PRINTING_OTHER](http://localhost:631/sam.html#PRINTING_OTHER)