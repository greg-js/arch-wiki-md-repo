**Состояние перевода:** На этой странице представлен перевод статьи [Overlay filesystem](/index.php/Overlay_filesystem "Overlay filesystem"). Дата последней синхронизации: 7 августа 2019\. Вы можете [помочь](/index.php/ArchWiki_Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ArchWiki Translation Team (Русский)") синхронизировать перевод, если в английской версии произошли [изменения](https://wiki.archlinux.org/index.php?title=Overlay_filesystem&diff=0&oldid=579089).

Из [первоначального коммита в ядро](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e9be9d5e76e34872f0c37d72e25bc27fe9e2c54c):

	Overlayfs позволяет накладывать одно дерево каталогов (обычно доступное в режиме «чтение-запись») на другое, но с доступом только для чтения. Все изменения переходят на верхний слой с возможностью записи. Данная схема чаще всего используется с Live CD, но существует и множество других применений.

	Данная реализация отличается от других каскадно-объединённых файловых систем тем, что после открытия файла все операции направляются непосредственно в базовую, "нижнюю" или "верхнюю" файловую систему, что упрощает реализацию и не ухудшает производительность в данных случаях.

Overlayfs доступен в ядре linux с версии 3.18.

<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none">

## Contents

<label class="toctogglelabel" for="toctogglecheckbox"></label>

*   [1 Установка](#Установка)
*   [2 Использование](#Использование)
    *   [2.1 Overlay только для чтения](#Overlay_только_для_чтения)
*   [3 Смотрите также](#Смотрите_также)

## Установка

Overlayfs включён в ядре по умолчанию, а модуль `overlay` автоматически подгружается после ввода команды монтирования.

## Использование

Используйте следующие аргументы `mount` для монтирования overlay:

```
# mount -t overlay overlay -o lowerdir=*/lower*,upperdir=*/upper*,workdir=*/work* */merged*

```

**Примечание:** Рабочий каталог (`workdir`) должен быть пустым и находиться в той же точке монтирования файловой системы, что и верхний каталог.

Нижняя директория может быть списком каталогов, разделённых `:`, все изменения в каталоге `merged` по-прежнему будут отражаться в `upper`.

Пример:

```
# mount -t overlay overlay -o lowerdir=*/lower1:/lower2:/lower3*,upperdir=*/upper*,workdir=*/work* */merged*

```

**Примечание:** Порядок монтирования папок `lowerdir`: слева-направо/сверху-вниз. То есть крайняя левая папка из списка будет смонтирована как самый верхний слой из `lowerdir`, а крайняя правая папка, соответственно, как самый нижний слой.

Таким образом порядок слоёв из вышеупомянутого примера будет следующим:

```
/upper
/lower1
/lover2
/lover3

```

Используйте следующий формат, чтобы добавить запись overlayfs в `/etc/fstab`:

 `/etc/fstab`  `overlay */merged* overlay noauto,x-systemd.automount,lowerdir=*/lower*,upperdir=*/upper*,workdir=*/work* 0 0` 

Параметры монтирования `noauto` и `x-systemd.automount` необходимы для предотвращения зависания systemd при загрузке, например, из-за ошибки монтирования overlay. Также overlay теперь будет монтироваться при первом обращении, а запросы будут буферизироваться до готовности самого overlay. Для получения дополнительной информации смотрите раздел [Fstab (Русский)#Автоматическое монтирование с systemd](/index.php/Fstab_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Автоматическое_монтирование_с_systemd "Fstab (Русский)").

### Overlay только для чтения

Иногда необходимо создать представление из комбинации двух или более каталогов, доступное только для чтения. В этом случае его можно создать более простым способом, так как каталоги `upper` и `work` **не** обязательны:

```
# mount -t overlay overlay -o lowerdir=*/lower1:/lower2* */merged*

```

Когда `upperdir` не указан, overlay автоматически монтируется только для чтения.

## Смотрите также

*   [Документация файловой системы Overlay](https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt)