Ссылки по теме

*   [Файловые системы](/index.php/%D0%A4%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B "Файловые системы")

**Состояние перевода:** На этой странице представлен перевод статьи [Overlay filesystem](/index.php/Overlay_filesystem "Overlay filesystem"). Дата последней синхронизации: 27 ноября 2018\. Вы можете [помочь](/index.php/ArchWiki_Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ArchWiki Translation Team (Русский)") синхронизировать перевод, если в английской версии произошли [изменения](https://wiki.archlinux.org/index.php?title=Overlay_filesystem&diff=0&oldid=547185).

Из [the initial kernel commit](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e9be9d5e76e34872f0c37d72e25bc27fe9e2c54c)

	Overlayfs позволяет накладывать одно, обычно чтение и запись, дерево каталогов на другое дерево только для чтения. Все изменения переходят на верхний слой с возможностью записи. Этот тип механизма чаще всего используется для live компакт-дисков, но существует множество других применений.

	Реализация отличается от других реализаций "объединенных файловых систем" тем, что после открытия файла все операции идут непосредственно в базовую, нижнюю или верхнюю файловую систему. Это упрощает реализацию и позволяет использовать в этих случаях собственную производительность.

Overlayfs находится в ядре linux с версии 3.18.483209

<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none">

## Contents

<label class="toctogglelabel" for="toctogglecheckbox"></label>

*   [1 Установка](#Установка)
*   [2 Использование](#Использование)
    *   [2.1 Overlay только для чтения](#Overlay_только_для_чтения)
*   [3 Смотрите также](#Смотрите_также)

## Установка

Overlayfs включен в ядре по умолчанию, а модуль `overlay` автоматически загружается после ввода команды монтирования.

## Использование

Для монтирования overlay используйте следующие опции `mount`:

```
# mount -t overlay overlay -o lowerdir=*/lower*,upperdir=*/upper*,workdir=*/work* */merged*

```

**Примечание:** Рабочий каталог (`workdir`) должен быть на той же файловой системе, что и верхний каталог.

Нижняя директория может фактически быть списком каталогов, разделенных `:`, все изменения в каталоге `merged` по-прежнему отражаются в `upper`.

Пример:

```
# mount -t overlay overlay -o lowerdir=*/lower1:/lower2:/lower3*,upperdir=*/upper*,workdir=*/work* */merged*

```

**Примечание:** Порядок монтирования папок `lowerdir`: слева-направо/сверху-вниз. То есть крайняя левая папка из списка будет смонтированна как самый верхний слой из `lowerdir`, а крайняя правая папка будет смотированна, соответственно, как самый нижний слой.

Таким образом порядок следования слоев из вышеупомянутого примера будет следующим:

```
/upper
/lower1
/lover2
/lover3

```

Чтобы добавить запись overlayfs в `/etc/fstab`, используйте следующий формат:

 `/etc/fstab`  `overlay */merged* overlay noauto,x-systemd.automount,lowerdir=*/lower*,upperdir=*/upper*,workdir=*/work* 0 0` 

Параметры монтирования `noauto` и `x-systemd.automount` необходимы для предотвращения зависания systemd при загрузке, поскольку он не смонтировал overlay. Overlay теперь монтируется всякий раз, когда он получает первый доступ, и запросы буферизуются до тех пор, пока они не будут готовы. Для получения дополнительной информации смотрите [Fstab#Автоматическое монтирование с systemd](/index.php/Fstab_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Автоматическое_монтирование_с_systemd "Fstab (Русский)").

### Overlay только для чтения

Иногда желательно только создать представление только для чтения о комбинации двух или более каталогов. В этом случае его можно создать более простым способом, так как каталоги `upper` и `work` **не** обязательны:

```
# mount -t overlay overlay -o lowerdir=*/lower1:/lower2* */merged*

```

Когда `upperdir` не указан, overlay монтируется автоматически как только для чтения].

## Смотрите также

*   [Документация файловой системы Overlay](https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt)