**Состояние перевода:** На этой странице представлен перевод статьи [XDG MIME Applications](/index.php/XDG_MIME_Applications "XDG MIME Applications"). Дата последней синхронизации: 13 июля 2019\. Вы можете [помочь](/index.php/ArchWiki_Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "ArchWiki Translation Team (Русский)") синхронизировать перевод, если в английской версии произошли [изменения](https://wiki.archlinux.org/index.php?title=XDG_MIME_Applications&diff=0&oldid=576845).

Ссылки по теме

*   [Ярлыки приложений](/index.php/%D0%AF%D1%80%D0%BB%D1%8B%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9 "Ярлыки приложений")
*   [Окружение рабочего стола](/index.php/%D0%9E%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B1%D0%BE%D1%87%D0%B5%D0%B3%D0%BE_%D1%81%D1%82%D0%BE%D0%BB%D0%B0 "Окружение рабочего стола")
*   [Оконный менеджер](/index.php/%D0%9E%D0%BA%D0%BE%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80 "Оконный менеджер")

[Спецификация от XDG для приложений MIME](https://specifications.freedesktop.org/mime-apps-spec/mime-apps-spec-latest.html) основывается на [#Общей базе данных MIME](#Общая_база_данных_MIME) и на [#Ярлыках приложений](#Ярлыки_приложений) для предоставления [приложений по умолчанию](/index.php/%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BF%D0%BE_%D1%83%D0%BC%D0%BE%D0%BB%D1%87%D0%B0%D0%BD%D0%B8%D1%8E "Приложения по умолчанию").

1.  Программы описывают поддерживаемые MIME-типы используя [ярлыки приложений](/index.php/%D0%AF%D1%80%D0%BB%D1%8B%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9 "Ярлыки приложений").
2.  Пакет [desktop-file-utils](https://www.archlinux.org/packages/?name=desktop-file-utils) регистрирует [хук pacman](/index.php/Pacman_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Хуки "Pacman (Русский)") для построения базы данных с кешем поддерживаемых MIME-типов на основе ярлыков приложений, см. [update-desktop-database(1)](https://jlk.fjfi.cvut.cz/arch/manpages/man/update-desktop-database.1).
3.  Приложения могут устанавливать MIME-типы, добавляя XML-файлы в `/usr/share/mime/packages/`.
4.  Пакет [shared-mime-info](https://www.archlinux.org/packages/?name=shared-mime-info) регистрирует [хук pacman](/index.php/Pacman_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Хуки "Pacman (Русский)") для построения общей базы данных с кешем MIME-типов, см. [update-mime-database(1)](https://jlk.fjfi.cvut.cz/arch/manpages/man/update-mime-database.1).
5.  [Окружения рабочего стола](/index.php/Desktop_environment_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Desktop environment (Русский)") и пользователи могут изменять приложения по умолчанию и добавлять или удалять MIME-типы приложений используя файлы [mimeapps.list](#mimeapps.list).

<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none">

## Contents

<label class="toctogglelabel" for="toctogglecheckbox"></label>

*   [1 Общая база данных MIME](#Общая_база_данных_MIME)
    *   [1.1 Новый тип MIME](#Новый_тип_MIME)
*   [2 Ярлыки приложений](#Ярлыки_приложений)
*   [3 mimeapps.list](#mimeapps.list)
    *   [3.1 Формат](#Формат)
*   [4 Утилиты](#Утилиты)
    *   [4.1 lsdesktopf](#lsdesktopf)
*   [5 Решение проблем](#Решение_проблем)
    *   [5.1 Отсутствует ярлык приложения](#Отсутствует_ярлык_приложения)
    *   [5.2 Отсутствует ассоциация](#Отсутствует_ассоциация)
    *   [5.3 Нет приложения по умолчанию](#Нет_приложения_по_умолчанию)
    *   [5.4 Нестандартная ассоциация](#Нестандартная_ассоциация)
    *   [5.5 Переменные в файлах .desktop, которые влияют на запуск приложения](#Переменные_в_файлах_.desktop,_которые_влияют_на_запуск_приложения)

## Общая база данных MIME

[Спецификация от XDG для общей база данных MIME-info](https://specifications.freedesktop.org/shared-mime-info-spec/shared-mime-info-spec-latest.html) облегчает общую базу данных MIME в среде рабочего стола и позволяет приложениям легко регистрировать новые типы MIME общесистемно.

База данных построена из файлов XML, установленных пакетами в `/usr/share/mime/packages/`, используя инструменты из [shared-mime-info](https://www.archlinux.org/packages/?name=shared-mime-info).

Файлы в `/usr/share/mime/` не должны редактироваться напрямую, однако их можно сохранить в отдельную базу данных для каждого пользователя в `~/.local/share/mime/`.

"Обработка схемы URI [..] обрабатывается через приложения, обрабатывающие MIME-тип `x-scheme-handler/foo`, где foo - это схема URI, о которой идет речь."[[1]](https://specifications.freedesktop.org/shared-mime-info-spec/shared-mime-info-spec-latest.html#idm140625828587776)

### Новый тип MIME

В этом примере определяется новый тип MIME `application/x-foobar` и присваивается любому файлу с расширением *.foo*. Просто создайте следующий файл:

 `~/.local/share/mime/packages/application-x-foobar.xml` 
```
<?xml version="1.0" encoding="UTF-8"?>
<mime-info xmlns="http://www.freedesktop.org/standards/shared-mime-info">
    **<mime-type type="application/x-foobar">**
        <comment>foo file</comment>
        <icon name="application-x-foobar"/>
        <glob-deleteall/>
        **<glob pattern="*.foo"/>**
    </mime-type>
</mime-info>
```

А затем обновите базу данных MIME:

```
$ update-mime-database ~/.local/share/mime

```

Конечно, это никак не повлияет, если ярлыки приложения не связаны с типом MIME. Вам может потребоваться создать новые [#Ярлыки приложений](#Ярлыки_приложений) или отредактировать [#mimeapps.list](#mimeapps.list).

## Ярлыки приложений

Каждый пакет может использовать [ярлыки приложений](/index.php/%D0%AF%D1%80%D0%BB%D1%8B%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9 "Ярлыки приложений") для предоставления информации о типах MIME, которые могут быть обработаны с помощью программного обеспечения. Чтобы обеспечить быстрый поиск в обратном направлении, система использует инструменты из пакета [desktop-file-utils](https://www.archlinux.org/packages/?name=desktop-file-utils) для анализа файлов рабочего стола и создания обратного сопоставления, хранящегося в `/usr/share/applications/mimeinfo.cache`. Это единственный файл, который программы должны прочитать, чтобы найти все файлы рабочего стола, которые могут использоваться для обработки данного типа MIME. Использование базы данных проще и быстрее, чем непосредственно считывать сотни файлов *.desktop.*

Файлы в `/usr/share/applications/` не должны редактироваться напрямую, можно поддерживать отдельную базу данных для каждого пользователя в `~/.local/share/applications/`. Для получения дополнительной информации смотрите статью [Ярлыки приложений](/index.php/%D0%AF%D1%80%D0%BB%D1%8B%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9 "Ярлыки приложений").

## mimeapps.list

[Стандарт XDG](https://specifications.freedesktop.org/mime-apps-spec/mime-apps-spec-1.0.html) является наиболее распространенным при настройке окружения рабочего стола. Приложения по умолчанию для каждого типа MIME хранятся в файлах `mimeapps.list`, которые могут храниться в нескольких местах. Их проверяют в следующем порядке, причем более ранние ассоциации имеют приоритет над более поздними:

| Путь | Применение |
| `~/.config/mimeapps.list` | пользовательские переопределения |
| `/etc/xdg/mimeapps.list` | общесистемные переопределения |
| `~/.local/share/applications/mimeapps.list` | (**Устаревшее**) пользовательские переопределения |
| `/usr/local/share/applications/mimeapps.list`
`/usr/share/applications/mimeapps.list` | переопределения предоставляемые дистрибутивом по умолчанию |

Кроме того, можно определить [окружение рабочего стола](/index.php/%D0%9E%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B1%D0%BE%D1%87%D0%B5%D0%B3%D0%BE_%D1%81%D1%82%D0%BE%D0%BB%D0%B0 "Окружение рабочего стола") по умолчанию для конкретных приложений в файле с именем `*desktop*-mimeapps.list` где `*desktop*` это имя окружения рабочего стола (Из переменной окружения `XDG_CURRENT_DESKTOP`). Например, `/etc/xdg/xfce-mimeapps.list` определяет общесистемные переопределения приложений по умолчанию для [Xfce](/index.php/Xfce_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Xfce (Русский)"). Эти переопределения для рабочего стола имеют приоритет над соответствующим файлом, не относящимся к окружению рабочему столу. Например, `/etc/xdg/xfce-mimeapps.list` имеет приоритет над `/etc/xdg/mimeapps.list`, но по-прежнему переопределяется `~/.config/mimeapps.list`.

**Совет:** Некоторые приложения всё ещё используют файл `~/.local/share/applications/mimeapps.list` несмотря на то, что он устарел. Чтобы облегчить задачу, просто создайте символическую ссылку на `~/.config/mimeapps.list`: `$ ln -s ~/.config/mimeapps.list ~/.local/share/applications/mimeapps.list` 

**Примечание:** Вы также можете найти файлы в этих местах с именем `defaults.list`. Этот файл похож на `mimeapps.list`, за исключением того, что он отображает только приложения по умолчанию (не добавленные/удалённые ассоциации). Сейчас он устарел и должен быть вручную объединён с `mimeapps.list`.

#### Формат

Рассмотрим следующий пример:

 `mimeapps.list` 
```
[Added Associations]
image/jpeg=bar.desktop;baz.desktop
video/H264=bar.desktop
[Removed Associations]
video/H264=baz.desktop
[Default Applications]
image/jpeg=foo.desktop
```

Каждый раздел назначает один или несколько ярлыков приложений типам MIME.

*   **Added Associations** (Добавленные ассоциации) указывают, что приложения поддерживают открытие этого типа MIME. Например, `bar.desktop` и `baz.desktop` могут открывать изображения JPEG. Это может повлиять на список приложений, который вы видите при щелчке правой кнопкой мыши по файлу в файловом менеджере.
*   **Removed Associations** (Удаленные ассоциации) указывают, что приложения *не* поддерживают этот тип MIME. Например, `baz.desktop` не может открыть видео H.264.
*   **Default Applications** (Приложения по умолчанию) указывают, что приложения должны выбираться по умолчанию для открытия этого типа MIME. Например, изображения JPEG должны быть открыты с помощью `foo.desktop`. Это неявно добавляет связь между приложением и типом MIME. Если есть несколько приложений, они проверяются по порядку.

Каждый раздел является необязательным и может быть опущен, если он не нужен.

## Утилиты

Хотя приложения по умолчанию и типы MIME можно настроить путём редактирования [#mimeapps.list](#mimeapps.list) и [#Общей базы данных MIME](#Общая_база_данных_MIME), существует множество инструментов, которые упрощают данный процесс. Эти инструменты также важны, поскольку приложения могут делегировать открытие файлов этим инструментам, а не пытаться реализовать стандарт MIME-типов.

Если вы используете [окружение рабочего стола](/index.php/%D0%9E%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B1%D0%BE%D1%87%D0%B5%D0%B3%D0%BE_%D1%81%D1%82%D0%BE%D0%BB%D0%B0 "Окружение рабочего стола"), для начала проверьте, предоставляет ли оно свою собственную утилиту. Она должна быть предпочтительнее альтернатив.

Официальные утилиты [xdg-utils](/index.php/Xdg-utils_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9) "Xdg-utils (Русский)") содержат инструменты для управления типами MIME и приложениями по умолчанию в соответствии со стандартом XDG ([xdg-mime](/index.php/Xdg-utils_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#xdg-mime "Xdg-utils (Русский)")). Самое главное, что он предоставляет [xdg-open](/index.php/Xdg-utils_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#xdg-open "Xdg-utils (Русский)"), который многие приложения используют для открытия файла с его приложением по умолчанию.

### lsdesktopf

[lsdesktopf](https://aur.archlinux.org/packages/lsdesktopf/) предоставляет несколько способов поиска в базе данных MIME и ярлыков MIME на рабочем столе.

Например, чтобы увидеть все расширения MIME в файлах *.desktop* в системе, которые имеют тип MIME `video`, вы можете использовать `lsdesktopf --gm -gx video` или для поиска в файлах базы данных XML, используйте `lsdesktopf --gdx -gx video`. Чтобы получить краткий обзор того, сколько и какие файлы *.desktop* могут быть связаны с определенным типом MIME, используйте `lsdesktopf --gen-mimeapps`. Чтобы просмотреть все расширения имен файлов в файлах базы данных XML, используйте `lsdesktopf --gdx -gfx`.

## Решение проблем

Если файл не открывается вашим желаемым приложением по умолчанию, существует несколько возможных причин. Вам может потребоваться проверить каждый случай.

### Отсутствует ярлык приложения

Для связывания приложений с типами MIME требуются [ярлыки приложений](/index.php/%D0%AF%D1%80%D0%BB%D1%8B%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9 "Ярлыки приложений"). Убедитесь, что такая запись существует и может использоваться для открытия (вручную) файлов в приложении.

### Отсутствует ассоциация

Если в ярлыке приложения не указан тип MIME под его ключом `MimeType`, он не будет учитываться, когда приложение необходимо для открытия этого типа. Измените [#mimeapps.list](#mimeapps.list), чтобы добавить связь между файлом .desktop и типом MIME.

### Нет приложения по умолчанию

Если ярлык приложения связан с типом MIME, его нельзя установить по умолчанию. Измените [#mimeapps.list](#mimeapps.list), чтобы задать связь по умолчанию.

### Нестандартная ассоциация

Приложения могут игнорировать или частично реализовывать стандарт XDG. Проверьте использование устаревших файлов, таких как `~/.local/share/applications/mimeapps.list` и `~/.local/share/applications/defaults.list`. Если вы пытаетесь открыть файл из другого приложения (например, веб-браузера или файлового менеджера), проверьте, имеет ли это приложение собственный способ выбора приложений по умолчанию.

### Переменные в файлах .desktop, которые влияют на запуск приложения

Окружения рабочего стола и файловые менеджеры, поддерживающие программы запуска спецификаций в соответствии с определением в файлах *.desktop*. Смотрите раздел [Ярлыки приложений#Ярлык приложения](/index.php/%D0%AF%D1%80%D0%BB%D1%8B%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9#Ярлык_приложения "Ярлыки приложений").

Как правило, настройка упакованных файлов *.desktop* не требуется, но она может быть с ошибками. Даже если приложение содержит необходимое описание типа MIME в файле *.desktop*, то иногда переменная `MimeType`, которая используется для ассоциации, может неправильно запускаться или вообще не запускаться, или запускаться без открытия файла.

Это может произойти, например, если в переменной `Exec` отсутствуют внутренние параметры, необходимые для открытия файла или того, как приложение отображается в меню. Переменная `Exec` обычно начинается с `%`; чтобы узнать поддерживаемые параметры в настоящее время, см. [переменные exec](https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html#exec-variables).

В следующей таблице перечислены основные записи переменных файлов *.desktop* которые влияют на запуск приложения, если у него есть связанный тип MIME.

| Имена переменных | Пример 1 | Пример 2 | Описание |
| DBusActivatable | DBusActivatable=true | DBusActivatable=false | Приложение взаимодействует с [D-Bus](https://www.freedesktop.org/wiki/Software/dbus/).
Смотрите также настройки: [D-Bus](https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html#dbus). |
| MimeType | MimeType=application/vnd.oasis.opendocument.text | MimeType=application/vnd.sun.xml.math | Список типов MIME, поддерживаемых приложением |
| StartupWMClass | StartupWMClass=google-chrome | StartupWMClass=xpad | Связывает окна с владельцем приложения |
| Terminal | Terminal=true | Terminal=false | Запуск в терминале по умолчанию |