Windows 10 包含一个模拟 Linux 内核的子系统，使得 windows 可以运行 Linux 原生应用程序。这个子系统有点像反过来的 [Wine](/index.php/Wine "Wine")，但是它比 Wine 更加底层。默认情况下，此子系统使用 Ubuntu 用户空间，但是它可以被替换成 Arch。你需要使用一个现有的 Arch 安装去构建一些软件包，这篇说明基于[这篇教程](https://www.reddit.com/r/bashonubuntuonwindows/comments/5vnne8/howto_installing_arch_on_wsl_manually/)。

## 准备

你必须安装 Windows 10 创造者更新。如果你还没有使用过 Linux 子系统，请按照[这里](https://msdn.microsoft.com/en-gb/commandline/wsl/install_guide)安装。 简单来说，你需要打开：

*   开发人员模式，位于 *设置 > 更新和安全 > 针对开发人员*；
*   适用于 Linux 的 Windows 子系统(Beta)，位于 *启用或关闭 Windows 功能*。

**注意:** 如果你正在使用 Windows Insider 预览版，或者将来你安装了 Windows 10 2017年内秋季的创造者更新，你可以在[Windows 应用商店](https://www.microsoft.com/en-us/store/p/ubuntu/9nblggh4msv6)安装 Ubuntu。[详情请见](https://blogs.msdn.microsoft.com/commandline/2017/07/10/ubuntu-now-available-from-the-windows-store/)。

如果你已经开始使用，可以使用以下的命令完全删除已有的安装（在此之前，你可能需要保存你的数据）:

```
> lxrun /uninstall /full /y

```

## 安装

打开命令行，输入以下命令安装官方提供的 Ubuntu：

```
> lxrun /install /y

```

进入 Bash：

```
> bash ~

```

从 [Arch Linux Downloads](https://www.archlinux.org/download/) 下载 Arch bootstrap .tar.gz 然后解压：

```
$ tar -zxvf /mnt/c/Users/*username*/Downloads/archlinux-bootstrap-2017.06.01-x86_64.tar.gz

```

在 `~/root.x86_64/etc/pacman.d/mirrorlist` 文件中，选择需要的服务器，取消注释。

让 WSL 自动生成 `/etc/resolv.conf`：

```
$ echo "# This file was automatically generated by WSL. To stop automatic generation of this file, remove this line." > ~/root.x86_64/etc/resolv.conf

```

退出所有打开的 Bash 命令行窗口。

在 Windows 资源管理器中找到 `C:\Users\*username*\AppData\Local\lxss\rootfs`，然后删除 `bin`, `etc`, `lib`, `lib64`, `sbin`, `usr` and `var`.

然后从`C:\Users\*username*\AppData\Local\lxss\root\root.x86_64`移动(不要复制)相同的文件到 `C:\Users\*username*\AppData\Local\lxss\rootfs`

使用一台Linux电脑构建 [fakeroot-tcp](https://aur.archlinux.org/packages/fakeroot-tcp/) 和 [glibc-wsl](https://aur.archlinux.org/packages/glibc-wsl/), 然后复制到你的 Windows 电脑。 *glibc-wsl* 用于解决 [这个bug](https://github.com/Microsoft/BashOnWindows/issues/1878)。而直到 System V IPC 被完全实现之前 *fakeroot-tcp* 都是必需的。 （[(详情请见)](https://github.com/Microsoft/BashOnWindows/issues/1016)。

再次打开Bash，开始安装Arch：

```
# pacman-key --init
# pacman-key --populate archlinux
# pacman -U /mnt/c/Users/*username*/Downloads/glibc-wsl-2.25-2-x86_64.pkg.tar.xz
# pacman -U /mnt/c/Users/*username*/Downloads/fakeroot-tcp-1.21-2-x86_64.pkg.tar.xz
# pacman -Syyu base base-devel

```

设置用户 (不需要和 Windows 用户名相同)：

```
# useradd -m -G wheel -s /bin/bash *username*
# passwd root
# passwd *username*

```

设置此用户为默认用户

```
> lxrun /setdefaultuser *username*

```